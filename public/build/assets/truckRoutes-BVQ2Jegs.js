import{r as s,j as o,Q as A,S as p}from"./app-nYSkDZzl.js";import{A as D}from"./AuthenticatedLayout-ByzkxnQc.js";import I from"./Map-DycoI4f2.js";import M from"./InsertNewSite-D0uoxg6p.js";import{F as R}from"./FormModal-C1ilU8vA.js";import{c as k,s as i}from"./SweetAlert-B6gH6N9q.js";import"./Dropdown-DcFK8V4k.js";import"./app-logo-5yzjSYqx.js";import"./transition-DSFOxD-o.js";import"./index-Df4yr-hd.js";import"./iconBase-JCBFe3YS.js";import"./index-Sq2RjoCl.js";import"./index-B4JuciqI.js";import"./imageHelpers-BzNwYwgf.js";import"./mapbox-gl-zLSOt86j.js";import"./index-DCcqD1pL.js";import"./index-DRxUstJk.js";import"./can-3MqaZyCZ.js";import"./InputError-DP_gcyxB.js";import"./InputLabel-DoKZJlBo.js";import"./PrimaryButton-S2ReljtS.js";import"./TextInput-DV2mo3Rm.js";import"./react-select.esm-CfJbNnVC.js";import"./index-CnyDuYXe.js";import"./index-BSGjfKt-.js";function ae({auth:z,mapboxKey:S}){const[h,f]=s.useState(null),[g,x]=s.useState([]),[b,a]=s.useState(0),[m,l]=s.useState(null),[v,n]=s.useState(!1),[y,r]=s.useState({}),[u,c]=s.useState(!1),E=e=>{f(e)},j=e=>{setTimeout(()=>{a(t=>t+1),x(t=>[...t,{lng:e.coordinates.lng,lat:e.coordinates.lat,name:e.site_name,barangay:e.barangay,purok:e.purok}])},0)},w=e=>{l(e),r({site_name:e.site_name||"",status:e.status||"active"}),n(!0)},F=async e=>{if(await k("Delete Site",`Are you sure you want to delete "${e.site_name}"? This action cannot be undone.`,"Delete"))try{await p.delete(`/delete/site/${e.id}`,{preserveScroll:!0,onSuccess:()=>{i("success","Site deleted successfully"),a(d=>d+1)},onError:()=>{i("error","Failed to delete site")}})}catch(d){console.error("Delete error:",d),i("error","Failed to delete site")}},N=async e=>{c(!0);try{await p.patch(`/edit/site/${m.id}`,e,{preserveScroll:!0,onSuccess:()=>{i("success","Site updated successfully"),n(!1),l(null),r({}),a(t=>t+1)},onError:t=>{console.log("Update errors:",t),i("error","Failed to update site")},onFinish:()=>{c(!1)}})}catch(t){console.error("Edit submission error:",t),c(!1)}},T=[{name:"site_name",label:"Site Name",type:"text",required:!0,placeholder:"Enter site name"},{name:"status",label:"Status",type:"select",required:!0,options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"pending",label:"Pending"},{value:"maintenance",label:"Maintenance"}]}];return o.jsxs(D,{children:[o.jsx(A,{title:"Truck Routes"}),o.jsxs("div",{className:"h-screen flex flex-col",children:[o.jsxs("div",{className:"flex-1 relative",children:[o.jsx("div",{className:"absolute inset-0",children:o.jsx(I,{mapboxKey:S||"pk.eyJ1IjoibWFraXNlbnBhaSIsImEiOiJjbTkza3F0NzMwb21tMmxwdzRzYWFncTRoIn0.tRpH1NPUfzt9cvv4IOpxJA",onLocationSelect:E,collectionSites:g,refreshTrigger:b,onEditSite:w,onDeleteSite:F})}),o.jsx("div",{className:"absolute top-2 right-2 left-2 sm:left-auto sm:right-4 sm:top-4 w-auto sm:w-80 max-w-full max-h-[calc(100vh-100px)] overflow-y-auto bg-white rounded-lg shadow-lg z-10",children:o.jsx(M,{onSiteAdded:j,selectedLocation:h})})]}),o.jsx(R,{show:v,onClose:()=>{n(!1),l(null),r({})},title:"Edit Site",initialData:m,onSubmit:N,fields:T,submitText:u?"Updating...":"Update Site",processing:u,formData:y,onFormChange:r})]})]})}export{ae as default};
