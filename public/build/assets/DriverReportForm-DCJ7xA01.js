import{J as C,r as i,a as o,S as d,j as e}from"./app-DkI2eAcN.js";const T=({scheduleId:n,token:c})=>{const{props:P}=C(),[r,u]=i.useState({garbage_id:"",report_picture:null,kilograms:"",additional_notes:""}),[x,h]=i.useState([]),[f,y]=i.useState(!0),[g,p]=i.useState(!1),[v,j]=i.useState(!1),[b,N]=i.useState(null);i.useEffect(()=>{w(),k()},[n,c]);const w=async()=>{try{(await o.post("/validate-report-token",{schedule_id:n,token:c})).data.valid?j(!0):(alert("Invalid or expired access token. Please complete your route first."),d.visit("/dashboard"))}catch(t){console.error("Token validation error:",t),alert("Error validating access. Please try again."),d.visit("/dashboard")}finally{y(!1)}},k=async()=>{try{const t=await o.get("/garbage-types");h(t.data.data||[])}catch(t){console.error("Error fetching garbage types:",t)}},m=t=>{const{name:a,value:s}=t.target;u(l=>({...l,[a]:s}))},_=t=>{const a=t.target.files[0];if(a){if(!a.type.startsWith("image/")){alert("Please select an image file");return}if(a.size>5*1024*1024){alert("Image size should be less than 5MB");return}u(l=>({...l,report_picture:a}));const s=new FileReader;s.onload=l=>{N(l.target.result)},s.readAsDataURL(a)}},S=async t=>{if(t.preventDefault(),!r.garbage_id||!r.kilograms){alert("Please fill in all required fields");return}if(r.kilograms<0){alert("Weight cannot be negative");return}p(!0);try{const a=new FormData;a.append("schedule_id",n),a.append("garbage_id",r.garbage_id),a.append("kilograms",r.kilograms),a.append("additional_notes",r.additional_notes||""),r.report_picture&&a.append("report_picture",r.report_picture);const s=await o.post("/submit-report",a,{headers:{"Content-Type":"multipart/form-data"}});s.data.success?(alert("Report submitted successfully!"),await o.post("/invalidate-report-token",{schedule_id:n,token:c}),d.visit("/dashboard")):alert("Failed to submit report: "+(s.data.message||"Unknown error"))}catch(a){console.error("Error submitting report:",a),alert("Error submitting report. Please try again.")}finally{p(!1)}};return f?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Validating access..."})]})}):v?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-green-500 text-6xl mb-4",children:"✅"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Route Completed!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Please submit your collection report"})]}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Garbage Type *"}),e.jsxs("select",{name:"garbage_id",value:r.garbage_id,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Garbage Type"}),x.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Weight Collected (Kilograms) *"}),e.jsx("input",{type:"number",name:"kilograms",value:r.kilograms,onChange:m,min:"0",step:"0.1",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter weight in kilograms"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Collection Photo"}),e.jsx("input",{type:"file",accept:"image/*",onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),b&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Preview:"}),e.jsx("img",{src:b,alt:"Preview",className:"max-w-full h-48 object-cover rounded-md border"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),e.jsx("textarea",{name:"additional_notes",value:r.additional_notes,onChange:m,rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Any additional information about the collection..."})]}),e.jsx("button",{type:"submit",disabled:g,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:g?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Submitting..."]}):"Submit Report"})]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"Invalid or expired access token."}),e.jsx("button",{onClick:()=>d.visit("/dashboard"),className:"mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700",children:"Return to Dashboard"})]})})};export{T as default};
