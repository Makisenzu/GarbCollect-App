import{r as o,j as e,a as z}from"./app-BOb0HgxJ.js";import le from"./ResidentMap-CeH4XC2g.js";import{S as ce}from"./react-select.esm-gp1YkpmP.js";import{C as J}from"./ClientPagination-B-3rFsSb.js";import de from"./ScheduleHero-D0pcFCNP.js";import{C as _}from"./clock-DflkfEg_.js";import{M as R}from"./map-pin-B4inxoZW.js";import{C as W}from"./calendar-CmWabBxi.js";import{c as me}from"./createLucideIcon-CpFAxkTM.js";import{C as ge,a as xe}from"./chevron-right-jcPf99gP.js";import{X as he}from"./x-WAlg--ni.js";import{T as ue}from"./truck-Cl2hNh6A.js";import"./mapbox-gl-DLUiATf0.js";import"./index-B4ysaZOQ.js";import"./iconBase-BHEkeEIS.js";import"./index-CnyDuYXe.js";import"./index-axsXyPTA.js";import"./sanfrance-BkZK3VBS.js";import"./arrow-left-D3oHEE_M.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],ye=me("calendar-days",pe),v=["January","February","March","April","May","June","July","August","September","October","November","December"],be=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Y=(u,x)=>new Date(u,x+1,0).getDate(),fe=(u,x)=>new Date(u,x,1).getDay(),Ue=()=>{const[u,x]=o.useState(!1),[N,V]=o.useState(null),[i,X]=o.useState(null),[K,q]=o.useState([]),[$,w]=o.useState([]),[A,P]=o.useState(!0),[F,L]=o.useState(!1),[h]=o.useState(new Date),[c,B]=o.useState(h.getMonth()),[m,E]=o.useState(h.getFullYear()),[p,G]=o.useState("today"),[je,ve]=o.useState(!1),[S,b]=o.useState(1),[D]=o.useState(5);o.useEffect(()=>{(async()=>{try{P(!0);const s=await z.get("/getBarangay");if(s.data.success){const a=s.data.barangay_data.map(l=>({value:l.id,label:l.baranggay_name}));q(a)}}catch(s){console.error("Error fetching barangays:",s)}finally{P(!1)}})()},[]),o.useEffect(()=>{(async()=>{if(!i){w([]);return}try{L(!0);const s=await z.get(`/getBarangay/schedule/${i.value}`);s.data.success&&(w(s.data.barangaySchedule||[]),b(1))}catch(s){console.error("Error fetching schedules:",s),w([])}finally{L(!1)}})()},[i]),o.useEffect(()=>{b(1)},[p]);const H=t=>{const s=new Date,r=new Date(t.collection_date),a=new Date().toDateString(),l=new Date(t.collection_date).toDateString();if(a!==l)return r<s?t.status==="completed"?"completed":"failed":"upcoming";if(t.collection_time){const[n,y]=t.collection_time.split(":");r.setHours(parseInt(n),parseInt(y),0)}else r.setHours(8,0,0);const d=new Date(r);return d.setHours(d.getHours()+4),s<r?"upcoming":s>=r&&s<=d?t.status==="in_progress"?"progress":"active":s>d&&t.status==="completed"?"completed":s>d&&t.status!=="completed"?"failed":"upcoming"},Q=t=>{const s=H(t);return s==="active"||s==="progress"},M=t=>{V(t),x(!0),setTimeout(()=>{var s;(s=document.getElementById("resident-map-section"))==null||s.scrollIntoView({behavior:"smooth"})},100)},Z=t=>{const s=new Date(t),r=v[s.getMonth()],a=s.getDate(),l=s.toLocaleDateString("en-US",{weekday:"long"});return`${r} ${a} - ${l}`},ee=t=>{if(!t)return"8:00 AM";try{if(typeof t=="string"&&t.includes(":")){const[s,r]=t.split(":"),a=parseInt(s),l=a>=12?"PM":"AM";return`${a%12||12}:${r} ${l}`}}catch(s){console.error("Error formatting time:",s)}return"8:00 AM"},te=t=>{const s=new Date,r=new Date(t.collection_date);if(t.collection_time){const[j,g]=t.collection_time.split(":");r.setHours(parseInt(j),parseInt(g),0)}else r.setHours(8,0,0);const a=r.getTime()-s.getTime();if(a<=0)return{days:0,hours:0,minutes:0,seconds:0,isActive:!0};const l=Math.floor(a/(1e3*60*60*24)),d=Math.floor(a%(1e3*60*60*24)/(1e3*60*60)),n=Math.floor(a%(1e3*60*60)/(1e3*60)),y=Math.floor(a%(1e3*60)/1e3);return{days:l,hours:d,minutes:n,seconds:y,isActive:!1}},k=()=>$.length?$.map(t=>{const s=H(t),r=Z(t.collection_date),a=ee(t.collection_time),l=te(t);return{id:t.id,formattedDate:r,time:a,status:s,timeRemaining:l,collection_date:t.collection_date,collection_time:t.collection_time,originalData:t}}):(console.log("No schedules available for transformation"),[]),f=t=>{switch(t){case"active":return"bg-green-500/20 text-green-700 border-green-400/30";case"progress":return"bg-yellow-500/20 text-yellow-700 border-yellow-400/30";case"completed":return"bg-blue-500/20 text-blue-700 border-blue-400/30";case"failed":return"bg-red-500/20 text-red-700 border-red-400/30";case"upcoming":return"bg-purple-500/20 text-purple-700 border-purple-400/30";default:return"bg-gray-500/20 text-gray-700 border-gray-400/30"}},O=t=>{const s=(S-1)*D;return t.slice(s,s+D)},U=t=>Math.ceil(t.length/D),C=()=>{if(!i)return[];const t=new Date().toDateString();return k().filter(s=>new Date(s.collection_date).toDateString()===t&&Q(s.originalData))},T=()=>{if(!i)return[];const t=new Date,s=new Date;return s.setDate(t.getDate()+7),k().filter(r=>{const a=new Date(r.collection_date);return a>=t&&a<=s})},I=()=>{if(!i)return console.log("No barangay selected"),[];const s=k().filter(r=>{const a=new Date(r.collection_date);return a.getMonth()===c&&a.getFullYear()===m}).map(r=>{const a=new Date(r.collection_date);return{...r,date:a.getDate(),dayName:a.toLocaleDateString("en-US",{weekday:"long"})}});return console.log("Month schedules:",s.length),s},se=()=>{B(t=>t===0?11:t-1),c===0&&E(t=>t-1)},ae=()=>{B(t=>t===11?0:t+1),c===11&&E(t=>t+1)},re=()=>{const t=Y(m,c),s=fe(m,c),r=I(),a=[];for(let n=0;n<s;n++)a.push(e.jsx("div",{className:"min-h-20 bg-gray-100/30 rounded-lg opacity-50",children:e.jsx("div",{className:"text-sm text-gray-400 p-2",children:Y(c===0?m-1:m,c===0?11:c-1)-s+n+1})},`empty-${n}`));for(let n=1;n<=t;n++){const y=r.filter(g=>g.date===n),j=n===h.getDate()&&c===h.getMonth()&&m===h.getFullYear();a.push(e.jsxs("div",{className:`min-h-20 p-2 rounded-lg border transition-all ${j?"bg-green-500/20 border-green-500":"bg-white border-gray-200 hover:border-green-300"}`,children:[e.jsx("div",{className:`text-sm font-semibold mb-1 ${j?"text-green-700":"text-gray-900"}`,children:n}),e.jsx("div",{className:"space-y-1",children:y.map((g,ie)=>e.jsx("div",{children:e.jsx("span",{className:`text-xs px-2 py-1 rounded border block truncate ${f(g.status)}`,children:g.status.charAt(0).toUpperCase()+g.status.slice(1)})},ie))})]},n))}const d=42-(s+t);for(let n=0;n<d;n++)a.push(e.jsx("div",{className:"min-h-20 bg-gray-100/30 rounded-lg opacity-50",children:e.jsx("div",{className:"text-sm text-gray-400 p-2",children:n+1})},`next-${n}`));return a},ne={control:t=>({...t,height:"52px",border:"2px solid #e5e7eb",borderRadius:"12px",fontSize:"1rem",boxShadow:"0 2px 10px -3px rgba(0, 0, 0, 0.1)","&:hover":{borderColor:"#10b981"}}),option:(t,s)=>({...t,backgroundColor:s.isSelected?"#10b981":s.isFocused?"#ecfdf5":"white",color:s.isSelected?"white":"#374151"})},[Ne,oe]=o.useState(new Date);return o.useEffect(()=>{const t=setInterval(()=>{oe(new Date)},1e3);return()=>clearInterval(t)},[]),A?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-green-50 to-blue-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading barangays..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-green-50 to-blue-50",children:[e.jsx(de,{}),e.jsxs("main",{className:"container mx-auto px-4 py-12 -mt-12",children:[e.jsx("div",{className:"max-w-2xl mx-auto mb-12",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Find Collection Schedules"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Select your barangay to view collection schedules"})]}),e.jsx(ce,{value:i,onChange:X,options:K,placeholder:"Choose your barangay...",styles:ne,isSearchable:!0,isClearable:!0,isLoading:A})]})}),i&&e.jsxs("div",{className:"max-w-6xl mx-auto",children:[F&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto"}),e.jsxs("p",{className:"mt-4 text-gray-600",children:["Loading active schedules for ",i.label,"..."]})]}),!F&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("div",{className:"bg-white rounded-xl shadow-md p-1",children:["today","week","month"].map(t=>e.jsx("button",{onClick:()=>G(t),className:`px-6 py-3 rounded-lg font-semibold transition-all ${p===t?"bg-green-500 text-white shadow-lg":"text-gray-700 hover:text-green-600"}`,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})}),p==="today"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Today's Active Collections"}),e.jsx("p",{className:"text-gray-600",children:h.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsx("div",{className:"p-6",children:C().length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:O(C()).map((t,s)=>e.jsx("div",{className:"border border-gray-200 rounded-xl p-6 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.formattedDate}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx(_,{className:"h-4 w-4"}),"Start - ",t.time]}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full mt-2 inline-block ${f(t.status)}`,children:t.status==="progress"?"In Progress":"Active"})]}),e.jsx("div",{className:"text-right",children:e.jsxs("button",{onClick:()=>M(t),className:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors shadow-md hover:shadow-lg flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Track Live"]})})]})},s))}),e.jsx(J,{currentPage:S,totalPages:U(C()),onPageChange:b})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(W,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-600",children:"No active collections for today"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Check back later for updates"})]})})]}),p==="week"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800",children:["This Week's Collections - ",i.label]}),e.jsx("p",{className:"text-gray-600",children:"Schedules for the next 7 days"})]}),e.jsx("div",{className:"p-6",children:T().length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:O(T()).map((t,s)=>e.jsx("div",{className:"border border-gray-200 rounded-xl p-6 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.formattedDate}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx(_,{className:"h-4 w-4"}),"Start - ",t.time]}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full mt-2 inline-block ${f(t.status)}`,children:t.status==="progress"?"In Progress":t.status==="active"?"Active":t.status==="upcoming"?"Upcoming":t.status.charAt(0).toUpperCase()+t.status.slice(1)})]}),e.jsx("div",{className:"text-right",children:t.status==="active"||t.status==="progress"?e.jsxs("button",{onClick:()=>M(t),className:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors shadow-md hover:shadow-lg flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Track Live"]}):e.jsxs("div",{className:"text-gray-500 text-sm",children:[t.timeRemaining.days>0&&`${t.timeRemaining.days}d `,t.timeRemaining.hours,"h ",t.timeRemaining.minutes,"m"]})})]})},s))}),e.jsx(J,{currentPage:S,totalPages:U(T()),onPageChange:b})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ye,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-600",children:"No collections scheduled this week"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Check the month view for upcoming schedules"})]})})]}),p==="month"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800",children:["Monthly Schedule - ",i.label]}),e.jsxs("p",{className:"text-gray-600",children:[v[c]," ",m]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:se,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(ge,{className:"h-5 w-5"})}),e.jsx("button",{onClick:ae,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(xe,{className:"h-5 w-5"})})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-4",children:be.map(t=>e.jsx("div",{className:"text-center text-sm font-semibold text-gray-600 py-2",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:re()}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:["Collection Schedule for ",v[c]," ",m]}),I().length>0?e.jsx("div",{className:"space-y-4",children:I().map((t,s)=>e.jsx("div",{className:"border border-gray-200 rounded-xl p-6 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.formattedDate}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx(_,{className:"h-4 w-4"}),"Start - ",t.time]}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full mt-2 inline-block ${f(t.status)}`,children:t.status==="progress"?"In Progress":t.status==="active"?"Active":t.status==="upcoming"?"Upcoming":t.status.charAt(0).toUpperCase()+t.status.slice(1)})]}),e.jsx("div",{className:"text-right",children:t.status==="active"||t.status==="progress"?e.jsxs("button",{onClick:()=>M(t),className:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors shadow-md hover:shadow-lg flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Track Live"]}):e.jsxs("div",{className:"text-gray-500 text-sm",children:[t.timeRemaining.days>0&&`${t.timeRemaining.days}d `,t.timeRemaining.hours,"h ",t.timeRemaining.minutes,"m"]})})]})},s))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-600",children:["No collections scheduled for ",v[c]," ",m]}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Try navigating to other months"})]})]})]})]}),u&&N&&e.jsx("div",{id:"resident-map-section",className:"mt-12",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Live Collection Map"}),e.jsxs("p",{className:"text-gray-600",children:["Real-time tracking for ",i.label," - ",N.formattedDate]})]}),e.jsx("button",{onClick:()=>x(!1),className:"text-gray-500 hover:text-gray-700 p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(he,{className:"h-5 w-5"})})]})}),e.jsx("div",{className:"p-6",children:e.jsx(le,{mapboxKey:"pk.eyJ1IjoibWFraXNlbnBhaSIsImEiOiJjbTkza3F0NzMwb21tMmxwdzRzYWFncTRoIn0.tRpH1NPUfzt9cvv4IOpxJA",barangayId:i.value,scheduleId:N.id})})]})})]})]}),!i&&e.jsxs("div",{className:"max-w-2xl mx-auto text-center py-16",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-100 to-blue-100 rounded-full h-24 w-24 flex items-center justify-center mx-auto mb-6",children:e.jsx(ue,{className:"h-12 w-12 text-green-600"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Ready to Track Collections?"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Select your barangay to view ongoing collection schedules"})]})]})]})};export{Ue as default};
