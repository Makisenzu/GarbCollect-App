import{r as c,j as e}from"./app-D1e81X8p.js";import{M as V}from"./map-pin-BppSygyi.js";import{C as z}from"./circle-alert-pNmxZVdL.js";import{C as U}from"./calendar-1ryfsA_B.js";import{C as K}from"./clock-COO7VTGj.js";import{c as X}from"./createLucideIcon-DqqcrFop.js";import{E as q}from"./eye-CSIueUTt.js";import{X as G}from"./x-YdnPDojF.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Q=X("play",J);function ie({drivers:d,barangays:p,schedules:h,onStartTask:j,mapboxKey:k}){var T,A;const[b,y]=c.useState("today"),[f,o]=c.useState([]),[m,w]=c.useState(!1),[g,S]=c.useState(new Date),[C,M]=c.useState(null),[$,_]=c.useState(!1),v=d.length>0?(T=d[0])==null?void 0:T.barangay:null,N=(v==null?void 0:v.id)||(h.length>0?(A=h[0])==null?void 0:A.barangay_id:null);c.useEffect(()=>{const t=setInterval(()=>{S(new Date)},6e4);return()=>clearInterval(t)},[]);const D=t=>{if(!t.collection_date)return!1;try{const a=new Date(t.collection_date),r=new Date;return a.toDateString()===r.toDateString()}catch{return!1}},P=t=>{if(!t.collection_date||!t.collection_time)return!1;try{const a=g,r=new Date(t.collection_date),[s,x]=t.collection_time.split(":").map(Number),u=new Date(r);return u.setHours(s,x,0,0),a>=u}catch{return!1}},I=t=>{if(!t.collection_date||!t.collection_time)return"Invalid";try{const a=new Date(t.collection_date),[r,s]=t.collection_time.split(":").map(Number);a.setHours(r,s,0,0);const x=g,u=a.getTime()-x.getTime(),i=Math.floor(u/(1e3*60)),n=Math.floor(i/60),l=Math.floor(n/24);return i<0?D(t)?"Now":"Past":i===0?"Now":i<60?`${i}m`:n<24?`${n}h ${i%60}m`:l===1?"Tomorrow":`${l}d`}catch{return"Error"}};c.useEffect(()=>{if(!N){o([]);return}w(!0);let t=h.filter(s=>s.barangay_id==N);const a=g,r=new Date(a.getFullYear(),a.getMonth(),a.getDate());switch(b){case"today":t=t.filter(n=>new Date(n.collection_date).toDateString()===r.toDateString());break;case"week":const s=new Date(r);s.setDate(r.getDate()-r.getDay());const x=new Date(s);x.setDate(s.getDate()+6),t=t.filter(n=>{const l=new Date(n.collection_date);return l>=s&&l<=x});break;case"month":const u=new Date(a.getFullYear(),a.getMonth(),1),i=new Date(a.getFullYear(),a.getMonth()+1,0);t=t.filter(n=>{const l=new Date(n.collection_date);return l>=u&&l<=i});break}o(t),w(!1)},[N,b,h,g]);const F=t=>{const a=D(t),r=P(t),s=t.status==="active"||t.status==="pending"||t.status==="in_progress"||t.status==="progress";return a&&r&&s},E=async t=>{if(confirm("Are you sure you want to finish this task? This will open the completion report modal."))try{window.showCompletionReportModal?window.showCompletionReportModal(t.id):alert("Please complete all sites first before finishing the task.")}catch(a){console.error("Error finishing task:",a),alert("Failed to finish task. Please try again.")}},L=t=>{M(t),_(!0)},B=()=>{_(!1),M(null)},H=t=>{if(!t)return"N/A";try{return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch{return"Invalid"}},O=t=>{if(!t)return"N/A";try{const[a,r]=t.split(":").map(Number),s=a>=12?"PM":"AM";return`${a%12||12}:${r.toString().padStart(2,"0")} ${s}`}catch{return t}},W=t=>{const r={in_progress:{color:"bg-amber-100 text-amber-800 border-amber-200",label:"In Progress"},active:{color:"bg-blue-100 text-blue-800 border-blue-200",label:"Active"},inactive:{color:"bg-gray-100 text-gray-800 border-gray-200",label:"Inactive"},completed:{color:"bg-green-100 text-green-800 border-green-200",label:"Completed"},done:{color:"bg-green-100 text-green-800 border-green-200",label:"Done"},failed:{color:"bg-red-100 text-red-800 border-red-200",label:"Failed"},pending:{color:"bg-amber-100 text-amber-800 border-amber-200",label:"Pending"}}[t]||{color:"bg-gray-100 text-gray-800 border-gray-200",label:t};return e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border ${r.color}`,children:r.label})},Y=({schedule:t})=>{const a=D(t),r=F(t),s=I(t);return e.jsx("div",{className:`bg-white rounded-xl border hover:shadow-lg transition-all duration-200 overflow-hidden ${a?"border-blue-300 bg-gradient-to-br from-blue-50 to-white":"border-gray-200"}`,children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(U,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:H(t.collection_date)}),a&&e.jsx("span",{className:"text-xs bg-blue-600 text-white px-2.5 py-1 rounded-full font-medium",children:"Today"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(K,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:O(t.collection_time)}),!r&&e.jsx("span",{className:"text-xs bg-amber-100 text-amber-700 px-2.5 py-1 rounded-full font-medium",children:s})]})]}),W(t.status)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("button",{onClick:()=>r&&j(t),disabled:!r,className:`flex-1 flex items-center justify-center gap-2 px-3 sm:px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ${r?"bg-gradient-to-r from-green-600 to-green-700 text-white hover:from-green-700 hover:to-green-800 shadow-sm hover:shadow-md":"bg-gray-100 text-gray-400 cursor-not-allowed border border-gray-200"}`,children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:r?"Start Task":"Not Available"}),e.jsx("span",{className:"sm:hidden",children:r?"Start":"N/A"})]}),t.status==="in_progress"&&e.jsxs("button",{onClick:()=>E(t),className:"flex-1 flex items-center justify-center gap-2 px-3 sm:px-4 py-2.5 bg-gradient-to-r from-orange-600 to-orange-700 text-white rounded-lg text-sm font-medium hover:from-orange-700 hover:to-orange-800 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),"Finish"]}),e.jsxs("button",{onClick:()=>L(t),className:"flex-1 flex items-center justify-center gap-2 px-3 sm:px-4 py-2.5 bg-white border border-blue-300 text-blue-600 rounded-lg text-sm font-medium hover:bg-blue-50 transition-colors",children:[e.jsx(q,{className:"w-4 h-4"}),"Details"]})]})]})})},R=[{value:"today",label:"Today"},{value:"week",label:"Week"},{value:"month",label:"Month"}];return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Collection Schedules"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage your waste collection tasks"})]}),e.jsx("div",{className:"flex gap-2",children:R.map(t=>e.jsx("button",{onClick:()=>y(t.value),className:`flex-1 px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ${b===t.value?"bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-sm":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:t.label},t.value))}),N?m?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-blue-600 border-t-transparent"})}):f.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(z,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-1",children:"No Schedules Found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No collection tasks for this period"})]}):e.jsx("div",{className:"space-y-4",children:f.map(t=>e.jsx(Y,{schedule:t},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(V,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-1",children:"No Assigned Barangay"}),e.jsx("p",{className:"text-sm text-gray-500",children:"You haven't been assigned to any barangay yet"})]})]}),$&&C&&e.jsx(Z,{schedule:C,onClose:B,barangays:p})]})}const Z=({schedule:d,onClose:p,barangays:h})=>{var y,f;const j=((y=d.barangay)==null?void 0:y.baranggay_name)||"N/A";(f=d.collections)!=null&&f.length;const k=o=>{if(!o)return"N/A";try{return new Date(o).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch{return"Invalid Date"}},b=o=>{if(!o)return"N/A";try{const[m,w]=o.split(":").map(Number),g=m>=12?"PM":"AM";return`${m%12||12}:${w.toString().padStart(2,"0")} ${g}`}catch{return o}};return e.jsx("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"relative bg-gradient-to-br from-slate-800 via-slate-700 to-slate-800 px-8 py-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white tracking-tight",children:"Schedule Details"}),e.jsx("p",{className:"text-slate-300 text-sm mt-1.5 font-medium",children:"Collection Schedule Information"})]}),e.jsx("button",{onClick:p,className:"ml-4 p-2 text-slate-300 hover:text-white hover:bg-slate-600 rounded-lg transition-all duration-200","aria-label":"Close modal",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-500 via-indigo-500 to-blue-500"})]}),e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2",children:"Barangay"}),e.jsx("div",{className:"text-xl font-semibold text-gray-900 bg-gray-50 px-4 py-3 rounded-lg border border-gray-200",children:j})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2",children:"Collection Date"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900 bg-gray-50 px-4 py-3 rounded-lg border border-gray-200",children:k(d.collection_date)})]}),e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2",children:"Collection Time"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900 bg-gray-50 px-4 py-3 rounded-lg border border-gray-200",children:b(d.collection_time)})]})]})]})}),e.jsx("div",{className:"bg-gray-50 px-8 py-5 border-t border-gray-200 flex gap-3",children:e.jsx("button",{onClick:p,className:"flex-1 px-6 py-3 bg-slate-700 text-white rounded-lg font-semibold hover:bg-slate-800 active:bg-slate-900 transition-all duration-200 shadow-sm hover:shadow-md",children:"Close"})})]})})};export{ie as default};
