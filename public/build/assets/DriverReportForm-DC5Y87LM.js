import{J as R,r as n,a as c,S as d,j as e}from"./app-CkN8LLiX.js";const G=({scheduleId:o,token:m})=>{const{props:F}=R(),[a,u]=n.useState({garbage_id:"",report_pictures:[],kilograms:"",additional_notes:""}),[y,v]=n.useState([]),[j,N]=n.useState(!0),[b,h]=n.useState(!1),[w,_]=n.useState(!1),[g,x]=n.useState([]);n.useEffect(()=>{k(),S()},[o,m]);const k=async()=>{try{(await c.post("/validate-report-token",{schedule_id:o,token:m})).data.valid?_(!0):(alert("Invalid or expired access token. Please complete your route first."),d.visit("/dashboard"))}catch(s){console.error("Token validation error:",s),alert("Error validating access. Please try again."),d.visit("/dashboard")}finally{N(!1)}},S=async()=>{try{const s=await c.get("/garbage-types");v(s.data.data||[])}catch(s){console.error("Error fetching garbage types:",s)}},p=s=>{const{name:t,value:r}=s.target;u(i=>({...i,[t]:r}))},C=s=>{const t=Array.from(s.target.files);if(t.length===0)return;const r=[],i=[];for(const l of t){if(!l.type.startsWith("image/")){alert(`${l.name} is not an image file`);continue}if(l.size>5*1024*1024){alert(`${l.name} is larger than 5MB`);continue}r.push(l);const f=new FileReader;f.onload=P=>{i.push(P.target.result),i.length===r.length&&x(T=>[...T,...i])},f.readAsDataURL(l)}r.length>0&&u(l=>({...l,report_pictures:[...l.report_pictures,...r]}))},D=s=>{u(t=>({...t,report_pictures:t.report_pictures.filter((r,i)=>i!==s)})),x(t=>t.filter((r,i)=>i!==s))},E=async s=>{if(s.preventDefault(),!a.garbage_id||!a.kilograms){alert("Please fill in all required fields");return}if(a.kilograms<0){alert("Weight cannot be negative");return}h(!0);try{const t=new FormData;t.append("schedule_id",o),t.append("garbage_id",a.garbage_id),t.append("kilograms",a.kilograms),t.append("additional_notes",a.additional_notes||""),a.report_pictures.length>0&&a.report_pictures.forEach((i,l)=>{t.append(`report_pictures[${l}]`,i)});const r=await c.post("/submit-report",t,{headers:{"Content-Type":"multipart/form-data"}});r.data.success?(alert("Report submitted successfully!"),await c.post("/invalidate-report-token",{schedule_id:o,token:m}),d.visit("/dashboard")):alert("Failed to submit report: "+(r.data.message||"Unknown error"))}catch(t){console.error("Error submitting report:",t),alert("Error submitting report. Please try again.")}finally{h(!1)}};return j?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Validating access..."})]})}):w?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-green-500 text-6xl mb-4",children:"✅"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Route Completed!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Please submit your collection report"})]}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Garbage Type *"}),e.jsxs("select",{name:"garbage_id",value:a.garbage_id,onChange:p,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Garbage Type"}),y.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Weight Collected (Kilograms) *"}),e.jsx("input",{type:"number",name:"kilograms",value:a.kilograms,onChange:p,min:"0",step:"0.1",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter weight in kilograms"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Collection Photos (Multiple)"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:C,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"You can select multiple images (max 5MB each)"}),g.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Selected Images (",g.length,"):"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:g.map((s,t)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s,alt:`Preview ${t+1}`,className:"w-full h-32 object-cover rounded-md border"}),e.jsx("button",{type:"button",onClick:()=>D(t),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600",children:"×"})]},t))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),e.jsx("textarea",{name:"additional_notes",value:a.additional_notes,onChange:p,rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Any additional information about the collection..."})]}),e.jsx("button",{type:"submit",disabled:b,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:b?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Submitting..."]}):"Submit Report"})]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"Invalid or expired access token."}),e.jsx("button",{onClick:()=>d.visit("/dashboard"),className:"mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700",children:"Return to Dashboard"})]})})};export{G as default};
