import{r as l,a as y,j as e,S as E}from"./app-D1e81X8p.js";function z({isOpen:m,onClose:N,scheduleId:v,scheduleName:w,onSubmitSuccess:b}){const[T,k]=l.useState([]),[i,g]=l.useState([]),[h,p]=l.useState(null),[f,j]=l.useState(null),[x,d]=l.useState(!1),[c,o]=l.useState({});l.useEffect(()=>{m&&C()},[m]);const C=async()=>{try{const s=await y.get("/api/garbage-types");if(s.data.success){const t=s.data.data;k(t),g(t.map(a=>({garbage_id:a.id,garbage_type:a.garbage_type,sack_count:0})))}}catch(s){console.error("Error fetching garbage types:",s)}},u=(s,t)=>{g(a=>a.map(r=>r.garbage_id===s?{...r,sack_count:parseInt(t)||0}:r))},S=s=>{const t=s.target.files[0];t&&(p(t),j(URL.createObjectURL(t)))},_=async s=>{var t,a;s.preventDefault(),o({}),d(!0);try{if(!h){o({picture:"Report picture is required"}),d(!1);return}if(i.reduce((P,R)=>P+R.sack_count,0)===0){o({sacks:"Please enter at least one sack count"}),d(!1);return}const n=new FormData;n.append("schedule_id",v),n.append("report_picture",h),n.append("reports",JSON.stringify(i)),(await y.post("/driver/submit-completion-report",n,{headers:{"Content-Type":"multipart/form-data"}})).data.success&&(console.log("âœ… Completion report submitted successfully"),b&&b(),E.visit("/driver/task"))}catch(r){console.error("Error submitting report:",r),o({submit:((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to submit report. Please try again."})}finally{d(!1)}};return m?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[9999] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"ðŸŽ‰ All Sites Completed!"}),e.jsx("p",{className:"text-green-100 text-sm mt-1",children:"Please submit your collection report"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-green-100",children:"Schedule"}),e.jsx("div",{className:"font-semibold",children:w})]})]})}),e.jsxs("form",{onSubmit:_,className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[c.submit&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:c.submit}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Collection Report Picture ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center",children:f?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:f,alt:"Preview",className:"max-h-48 mx-auto rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>{p(null),j(null)},className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-2 hover:bg-red-600",children:"âœ•"})]}):e.jsxs("div",{children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ“·"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("span",{className:"text-blue-600 hover:text-blue-700 font-medium",children:"Click to upload picture"}),e.jsx("input",{type:"file",accept:"image/*",onChange:S,className:"hidden"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"PNG, JPG up to 5MB"})]})}),c.picture&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:c.picture})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:["Garbage Collected (Number of Sacks) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"space-y-3",children:i.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:"ðŸ—‘ï¸"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.garbage_type}),e.jsx("div",{className:"text-xs text-gray-500",children:"Number of sacks"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>u(s.garbage_id,Math.max(0,s.sack_count-1)),className:"w-8 h-8 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 font-bold",children:"-"}),e.jsx("input",{type:"number",min:"0",value:s.sack_count,onChange:t=>u(s.garbage_id,t.target.value),className:"w-20 text-center px-3 py-2 border border-gray-300 rounded-lg font-semibold"}),e.jsx("button",{type:"button",onClick:()=>u(s.garbage_id,s.sack_count+1),className:"w-8 h-8 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 font-bold",children:"+"})]})]},s.garbage_id))}),c.sacks&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:c.sacks})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Total Sacks Collected:"}),e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:i.reduce((s,t)=>s+t.sack_count,0)})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:N,disabled:x,className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:x,className:"flex-1 px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg hover:from-green-700 hover:to-emerald-700 font-semibold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:x?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Submitting..."]}):"Submit Report & Complete Task"})]}),e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-yellow-800",children:[e.jsx("span",{className:"font-semibold",children:"Note:"})," After submitting this report, the schedule will be marked as completed and you'll be redirected to the dashboard."]})})]})]})}):null}export{z as default};
