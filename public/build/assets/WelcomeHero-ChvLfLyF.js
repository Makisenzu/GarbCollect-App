import{r as j,j as e,a as k}from"./app-hBFkVOqz.js";const S=({schedules:m})=>{const[h,p]=j.useState(new Date),v=new Date().getDate(),b=new Date().getMonth(),w=new Date().getFullYear(),l=h.getMonth(),d=h.getFullYear(),N=new Date(d,l+1,0).getDate(),u=new Date(d,l,1).getDay(),o={};m&&Array.isArray(m)&&m.forEach(t=>{const r=new Date(t.collection_date);if(r.getMonth()===l&&r.getFullYear()===d){const s=r.getDate();o[s]||(o[s]=[]),o[s].push(t)}});const i=t=>{if(!t||t.length===0)return"";const r=t.some(a=>a.status==="failed"),s=t.some(a=>a.status==="completed"),n=t.some(a=>a.status==="active"||a.status==="pending"||a.status==="in_progress");return r?"bg-red-50 text-red-700 border border-red-200":s?"bg-green-50 text-green-700 border border-green-200":n?"bg-blue-50 text-blue-700 border border-blue-200":""},_=t=>{if(!t||t.length===0)return null;const r=t.some(a=>a.status==="failed"),s=t.some(a=>a.status==="completed"),n=t.some(a=>a.status==="active"||a.status==="pending"||a.status==="in_progress");return r?"bg-red-500":s?"bg-green-500":n?"bg-blue-500":null},y=t=>{p(r=>{const s=new Date(r);return t==="next"?s.setMonth(s.getMonth()+1):s.setMonth(s.getMonth()-1),s})},D=()=>{p(new Date)},g=[];for(let t=0;t<u;t++)g.push(e.jsx("div",{className:"h-10"},`empty-${t}`));for(let t=1;t<=N;t++){const r=t===v&&l===b&&d===w,s=o[t]||[],n=i(s),a=_(s);g.push(e.jsxs("div",{className:`h-10 flex flex-col items-center justify-center rounded-md cursor-pointer transition-all ${r?"bg-gray-900 text-white font-semibold":n||"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx("span",{className:"text-sm",children:t}),a&&!r&&e.jsx("div",{className:`w-1 h-1 rounded-full ${a} mt-0.5`})]},t))}const C=["January","February","March","April","May","June","July","August","September","October","November","December"];return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900",children:[C[l]," ",d]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:D,className:"text-xs px-2 py-1 text-blue-600 bg-blue-50 border border-blue-200 rounded hover:bg-blue-100 transition-colors",children:"Today"}),e.jsx("button",{onClick:()=>y("prev"),className:"p-1.5 rounded hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:()=>y("next"),className:"p-1.5 rounded hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})})]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-3",children:["S","M","T","W","T","F","S"].map((t,r)=>e.jsx("div",{className:"text-center text-xs font-semibold text-gray-500",children:t},r))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:g})]})};function O({schedules:m,todaysCollections:h,inProgress:p,completedTotal:v}){const b=new Date().getHours(),w=b<12?"Good morning":b<18?"Good afternoon":"Good evening",[l,d]=j.useState(!1),[N,u]=j.useState(!1),[o,i]=j.useState({type:"all",start_date:"",end_date:""}),_=t=>{const r=new Date,s=r.getFullYear(),n=r.getMonth();switch(t){case"today":return{start_date:r.toISOString().split("T")[0],end_date:r.toISOString().split("T")[0]};case"this_week":const a=new Date(r);return a.setDate(r.getDate()-r.getDay()),{start_date:a.toISOString().split("T")[0],end_date:r.toISOString().split("T")[0]};case"this_month":return{start_date:new Date(s,n,1).toISOString().split("T")[0],end_date:r.toISOString().split("T")[0]};case"last_month":const c=new Date(s,n-1,1),x=new Date(s,n,0);return{start_date:c.toISOString().split("T")[0],end_date:x.toISOString().split("T")[0]};default:return{start_date:"",end_date:""}}},y=t=>{if(t==="custom")i({...o,start_date:"",end_date:""});else{const r=_(t);i({...o,...r})}},D=t=>{if(!t||t.length===0)return"";const r=Object.keys(t[0]),s=r.join(","),n=t.map(a=>r.map(f=>{const c=a[f];if(c==null)return"";const x=String(c);return x.includes(",")?`"${x}"`:x}).join(","));return[s,...n].join(`
`)},g=(t,r)=>{const s=new Blob([t],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a"),a=URL.createObjectURL(s);n.setAttribute("href",a),n.setAttribute("download",r),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)},C=async()=>{var t,r;if(o.start_date&&o.end_date){const s=new Date(o.start_date),n=new Date(o.end_date);if(s>n){alert("Start date cannot be after end date");return}}d(!0);try{const s=await k.post("/admin/generate-report",o);if(s.data.success){if(!s.data.data||s.data.data.length===0){alert("No data found for the selected criteria. Please try different filters."),d(!1);return}const n=D(s.data.data),a=new Date().toISOString().split("T")[0],f=o.start_date&&o.end_date?`${o.start_date}_to_${o.end_date}`:a,c=`GarbCollect_Report_${o.type}_${f}.csv`;g(n,c),alert(`Report generated successfully! ${s.data.summary.total_schedules} schedules exported.`),u(!1),i({type:"all",start_date:"",end_date:""})}}catch(s){console.error("Error generating report:",s);const n=((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to generate report. Please try again.";alert(n)}finally{d(!1)}};return e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Generate Collection Report"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Report Type"}),e.jsxs("select",{value:o.type,onChange:t=>i({...o,type:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900",children:[e.jsx("option",{value:"all",children:"All Collections"}),e.jsx("option",{value:"completed",children:"Completed Only"}),e.jsx("option",{value:"active",children:"Active Only"}),e.jsx("option",{value:"failed",children:"Failed Only"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Range Preset"}),e.jsxs("select",{onChange:t=>y(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900",defaultValue:"custom",children:[e.jsx("option",{value:"custom",children:"Custom Date Range"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"this_week",children:"This Week"}),e.jsx("option",{value:"this_month",children:"This Month (December)"}),e.jsx("option",{value:"last_month",children:"Last Month (November)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),e.jsx("input",{type:"date",value:o.start_date,onChange:t=>i({...o,start_date:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty for all dates from the beginning"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),e.jsx("input",{type:"date",value:o.end_date,onChange:t=>i({...o,end_date:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty for all dates up to today"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:C,disabled:l,className:"flex-1 inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-gray-900 border border-gray-900 rounded-md hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download Report"]})}),e.jsx("button",{onClick:()=>{u(!1),i({type:"all",start_date:"",end_date:""})},disabled:l,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:w}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Welcome back, Admin"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Here's what's happening with your waste collection operations today."}),e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsxs("button",{onClick:()=>u(!0),className:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-gray-900 border border-gray-900 rounded-md hover:bg-gray-800 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),"Generate Reports"]})})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Today's Collections"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"In Progress"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:p||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:v||0})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(S,{schedules:m})})]})]})}export{O as WelcomeHero};
