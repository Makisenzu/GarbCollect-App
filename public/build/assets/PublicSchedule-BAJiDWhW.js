import{r as o,j as e,a as U}from"./app-B7J0SWTz.js";import ce from"./ResidentMap-Bx4faeBF.js";import{S as ie}from"./react-select.esm-4ZNVv0Rz.js";import{C as Y}from"./ClientPagination-BCfIsZ3n.js";import de from"./ScheduleHero-CX2ZTl02.js";import{C as _}from"./clock-PsJtUhwZ.js";import{M as P}from"./map-pin-DUaZoSGO.js";import{C as W}from"./calendar-JtNrkwmK.js";import{C as me,a as xe}from"./chevron-right-DL4yXENa.js";import{X as ge}from"./x-DzKTszgC.js";import{T as he}from"./truck-ZuNH2exx.js";import"./mapbox-gl-BWmm1S5w.js";import"./index-C-BD9K8n.js";import"./iconBase-DXSjkioo.js";import"./index-CnyDuYXe.js";import"./index-Djzd8WEg.js";import"./sanfrance-BkZK3VBS.js";import"./arrow-left-6NQPAFFk.js";import"./createLucideIcon-CP_FA1e8.js";const v=["January","February","March","April","May","June","July","August","September","October","November","December"],ue=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],V=(u,g)=>new Date(u,g+1,0).getDate(),pe=(u,g)=>new Date(u,g,1).getDay(),Ee=()=>{const[u,g]=o.useState(!1),[N,X]=o.useState(null),[l,K]=o.useState(null),[q,G]=o.useState([]),[$,w]=o.useState([]),[F,L]=o.useState(!0),[R,B]=o.useState(!1),[h]=o.useState(new Date),[i,E]=o.useState(h.getMonth()),[m,O]=o.useState(h.getFullYear()),[p,Q]=o.useState("today"),[be,fe]=o.useState(!1),[S,f]=o.useState(1),[D]=o.useState(5);o.useEffect(()=>{(async()=>{try{L(!0);const s=await U.get("/getBarangay");if(s.data.success){const a=s.data.barangay_data.map(c=>({value:c.id,label:c.baranggay_name}));G(a)}}catch(s){console.error("Error fetching barangays:",s)}finally{L(!1)}})()},[]),o.useEffect(()=>{(async()=>{if(!l){w([]);return}try{B(!0);const s=await U.get(`/getBarangay/schedule/${l.value}`);s.data.success&&(w(s.data.barangaySchedule||[]),f(1))}catch(s){console.error("Error fetching schedules:",s),w([])}finally{B(!1)}})()},[l]),o.useEffect(()=>{f(1)},[p]);const H=t=>{const s=new Date,r=new Date(t.collection_date),a=new Date().toDateString(),c=new Date(t.collection_date).toDateString();if(a!==c)return r<s?t.status==="completed"?"completed":"failed":"upcoming";if(t.collection_time){const[n,b]=t.collection_time.split(":");r.setHours(parseInt(n),parseInt(b),0)}else r.setHours(8,0,0);const d=new Date(r);return d.setHours(d.getHours()+4),s<r?"upcoming":s>=r&&s<=d?t.status==="in_progress"?"progress":"active":s>d&&t.status==="completed"?"completed":s>d&&t.status!=="completed"?"failed":"upcoming"},C=t=>{const s=H(t);return s==="active"||s==="progress"},M=t=>{X(t),g(!0),setTimeout(()=>{var s;(s=document.getElementById("resident-map-section"))==null||s.scrollIntoView({behavior:"smooth"})},100)},Z=t=>{const s=new Date(t),r=v[s.getMonth()],a=s.getDate(),c=s.toLocaleDateString("en-US",{weekday:"long"});return`${r} ${a} - ${c}`},ee=t=>{if(!t)return"8:00 AM";try{if(typeof t=="string"&&t.includes(":")){const[s,r]=t.split(":"),a=parseInt(s),c=a>=12?"PM":"AM";return`${a%12||12}:${r} ${c}`}}catch(s){console.error("Error formatting time:",s)}return"8:00 AM"},te=t=>{const s=new Date,r=new Date(t.collection_date);if(t.collection_time){const[j,x]=t.collection_time.split(":");r.setHours(parseInt(j),parseInt(x),0)}else r.setHours(8,0,0);const a=r.getTime()-s.getTime();if(a<=0)return{days:0,hours:0,minutes:0,seconds:0,isActive:!0};const c=Math.floor(a/(1e3*60*60*24)),d=Math.floor(a%(1e3*60*60*24)/(1e3*60*60)),n=Math.floor(a%(1e3*60*60)/(1e3*60)),b=Math.floor(a%(1e3*60)/1e3);return{days:c,hours:d,minutes:n,seconds:b,isActive:!1}},k=()=>$.length?$.map(t=>{const s=H(t),r=Z(t.collection_date),a=ee(t.collection_time),c=te(t);return{id:t.id,formattedDate:r,time:a,status:s,timeRemaining:c,collection_date:t.collection_date,collection_time:t.collection_time,originalData:t}}):(console.log("No schedules available for transformation"),[]),y=t=>{switch(t){case"active":return"bg-green-500/20 text-green-700 border-green-400/30";case"progress":return"bg-yellow-500/20 text-yellow-700 border-yellow-400/30";case"completed":return"bg-blue-500/20 text-blue-700 border-blue-400/30";case"failed":return"bg-red-500/20 text-red-700 border-red-400/30";case"upcoming":return"bg-purple-500/20 text-purple-700 border-purple-400/30";default:return"bg-gray-500/20 text-gray-700 border-gray-400/30"}},z=t=>{const s=(S-1)*D;return t.slice(s,s+D)},J=t=>Math.ceil(t.length/D),T=()=>{if(!l)return[];const t=new Date().toDateString();return k().filter(s=>new Date(s.collection_date).toDateString()===t&&C(s.originalData))},I=()=>l?k().filter(t=>C(t.originalData)):[],A=()=>l?k().filter(r=>C(r.originalData)).filter(r=>{const a=new Date(r.collection_date);return a.getMonth()===i&&a.getFullYear()===m}).map(r=>{const a=new Date(r.collection_date);return{...r,date:a.getDate(),dayName:a.toLocaleDateString("en-US",{weekday:"long"})}}):(console.log("No barangay selected"),[]),se=()=>{E(t=>t===0?11:t-1),i===0&&O(t=>t-1)},ae=()=>{E(t=>t===11?0:t+1),i===11&&O(t=>t+1)},re=()=>{const t=V(m,i),s=pe(m,i),r=A(),a=[];for(let n=0;n<s;n++)a.push(e.jsx("div",{className:"min-h-20 bg-gray-100/30 rounded-lg opacity-50",children:e.jsx("div",{className:"text-sm text-gray-400 p-2",children:V(i===0?m-1:m,i===0?11:i-1)-s+n+1})},`empty-${n}`));for(let n=1;n<=t;n++){const b=r.filter(x=>x.date===n),j=n===h.getDate()&&i===h.getMonth()&&m===h.getFullYear();a.push(e.jsxs("div",{className:`min-h-20 p-2 rounded-lg border transition-all ${j?"bg-green-500/20 border-green-500":"bg-white border-gray-200 hover:border-green-300"}`,children:[e.jsx("div",{className:`text-sm font-semibold mb-1 ${j?"text-green-700":"text-gray-900"}`,children:n}),e.jsx("div",{className:"space-y-1",children:b.map((x,le)=>e.jsx("div",{children:e.jsx("span",{className:`text-xs px-2 py-1 rounded border block truncate ${y(x.status)}`,children:x.status.charAt(0).toUpperCase()+x.status.slice(1)})},le))})]},n))}const d=42-(s+t);for(let n=0;n<d;n++)a.push(e.jsx("div",{className:"min-h-20 bg-gray-100/30 rounded-lg opacity-50",children:e.jsx("div",{className:"text-sm text-gray-400 p-2",children:n+1})},`next-${n}`));return a},ne={control:t=>({...t,height:"52px",border:"2px solid #e5e7eb",borderRadius:"12px",fontSize:"1rem",boxShadow:"0 2px 10px -3px rgba(0, 0, 0, 0.1)","&:hover":{borderColor:"#10b981"}}),option:(t,s)=>({...t,backgroundColor:s.isSelected?"#10b981":s.isFocused?"#ecfdf5":"white",color:s.isSelected?"white":"#374151"})},[ye,oe]=o.useState(new Date);return o.useEffect(()=>{const t=setInterval(()=>{oe(new Date)},1e3);return()=>clearInterval(t)},[]),F?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-green-50 to-blue-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading barangays..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-green-50 to-blue-50",children:[e.jsx(de,{}),e.jsxs("main",{className:"container mx-auto px-4 py-12 -mt-12",children:[e.jsx("div",{className:"max-w-2xl mx-auto mb-12",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Find Active Collections"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Select your barangay to view ongoing collection schedules"})]}),e.jsx(ie,{value:l,onChange:K,options:q,placeholder:"Choose your barangay...",styles:ne,isSearchable:!0,isClearable:!0,isLoading:F})]})}),l&&e.jsxs("div",{className:"max-w-6xl mx-auto",children:[R&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto"}),e.jsxs("p",{className:"mt-4 text-gray-600",children:["Loading active schedules for ",l.label,"..."]})]}),!R&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("div",{className:"bg-white rounded-xl shadow-md p-1",children:["today","week","month"].map(t=>e.jsx("button",{onClick:()=>Q(t),className:`px-6 py-3 rounded-lg font-semibold transition-all ${p===t?"bg-green-500 text-white shadow-lg":"text-gray-700 hover:text-green-600"}`,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})}),p==="today"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Today's Active Collections"}),e.jsx("p",{className:"text-gray-600",children:h.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsx("div",{className:"p-6",children:T().length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:z(T()).map((t,s)=>e.jsx("div",{className:"border border-gray-200 rounded-xl p-6 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.formattedDate}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx(_,{className:"h-4 w-4"}),"Start - ",t.time]}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full mt-2 inline-block ${y(t.status)}`,children:t.status==="progress"?"In Progress":"Active"})]}),e.jsx("div",{className:"text-right",children:e.jsxs("button",{onClick:()=>M(t),className:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors shadow-md hover:shadow-lg flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Track Live"]})})]})},s))}),e.jsx(Y,{currentPage:S,totalPages:J(T()),onPageChange:f})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(W,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-600",children:"No active collections for today"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Check back later for updates"})]})})]}),p==="week"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800",children:["Active Collections - ",l.label]}),e.jsx("p",{className:"text-gray-600",children:"Ongoing and active collection schedules"})]}),e.jsx("div",{className:"p-6",children:I().length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:z(I()).map((t,s)=>e.jsx("div",{className:"border border-gray-200 rounded-xl p-6 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.formattedDate}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx(_,{className:"h-4 w-4"}),"Start - ",t.time]}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full mt-2 inline-block ${y(t.status)}`,children:t.status==="progress"?"In Progress":"Active"})]}),e.jsx("div",{className:"text-right",children:e.jsxs("button",{onClick:()=>M(t),className:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors shadow-md hover:shadow-lg flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Track Live"]})})]})},s))}),e.jsx(Y,{currentPage:S,totalPages:J(I()),onPageChange:f})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl font-semibold text-gray-600",children:"No active collections this week"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Check the today tab for current collections"})]})})]}),p==="month"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800",children:["Active Collections - ",l.label]}),e.jsxs("p",{className:"text-gray-600",children:[v[i]," ",m]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:se,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(me,{className:"h-5 w-5"})}),e.jsx("button",{onClick:ae,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(xe,{className:"h-5 w-5"})})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-4",children:ue.map(t=>e.jsx("div",{className:"text-center text-sm font-semibold text-gray-600 py-2",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:re()}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:["Active Collection Details for ",v[i]," ",m]}),A().length>0?e.jsx("div",{className:"space-y-4",children:A().map((t,s)=>e.jsx("div",{className:"border border-gray-200 rounded-xl p-6 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.formattedDate}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx(_,{className:"h-4 w-4"}),"Start - ",t.time]}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full mt-2 inline-block ${y(t.status)}`,children:t.status==="progress"?"In Progress":"Active"})]}),e.jsx("div",{className:"text-right",children:e.jsxs("button",{onClick:()=>M(t),className:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors shadow-md hover:shadow-lg flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Track Live"]})})]})},s))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-600",children:["No active collections for ",v[i]," ",m]}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Check the today tab for current collections"})]})]})]})]}),u&&N&&e.jsx("div",{id:"resident-map-section",className:"mt-12",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Live Collection Map"}),e.jsxs("p",{className:"text-gray-600",children:["Real-time tracking for ",l.label," - ",N.formattedDate]})]}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-500 hover:text-gray-700 p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(ge,{className:"h-5 w-5"})})]})}),e.jsx("div",{className:"p-6",children:e.jsx(ce,{mapboxKey:"pk.eyJ1IjoibWFraXNlbnBhaSIsImEiOiJjbTkza3F0NzMwb21tMmxwdzRzYWFncTRoIn0.tRpH1NPUfzt9cvv4IOpxJA",barangayId:l.value,scheduleId:N.id})})]})})]})]}),!l&&e.jsxs("div",{className:"max-w-2xl mx-auto text-center py-16",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-100 to-blue-100 rounded-full h-24 w-24 flex items-center justify-center mx-auto mb-6",children:e.jsx(he,{className:"h-12 w-12 text-green-600"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Ready to Track Collections?"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Select your barangay to view ongoing collection schedules"})]})]})]})};export{Ee as default};
