import{r as y,j as e,a as k}from"./app-C3ZLLJ3m.js";const D=({schedules:x})=>{const[g,h]=y.useState(new Date),f=new Date().getDate(),p=new Date().getMonth(),j=new Date().getFullYear(),l=g.getMonth(),i=g.getFullYear(),v=new Date(i,l+1,0).getDate(),u=new Date(i,l,1).getDay(),o={};x&&Array.isArray(x)&&x.forEach(t=>{const s=new Date(t.collection_date);if(s.getMonth()===l&&s.getFullYear()===i){const a=s.getDate();o[a]||(o[a]=[]),o[a].push(t)}});const c=t=>{if(!t||t.length===0)return"";const s=t.some(r=>r.status==="failed"),a=t.some(r=>r.status==="completed"),m=t.some(r=>r.status==="active"||r.status==="pending"||r.status==="in_progress");return s?"bg-red-50 text-red-700 border border-red-200":a?"bg-green-50 text-green-700 border border-green-200":m?"bg-blue-50 text-blue-700 border border-blue-200":""},N=t=>{if(!t||t.length===0)return null;const s=t.some(r=>r.status==="failed"),a=t.some(r=>r.status==="completed"),m=t.some(r=>r.status==="active"||r.status==="pending"||r.status==="in_progress");return s?"bg-red-500":a?"bg-green-500":m?"bg-blue-500":null},b=t=>{h(s=>{const a=new Date(s);return t==="next"?a.setMonth(a.getMonth()+1):a.setMonth(a.getMonth()-1),a})},w=()=>{h(new Date)},n=[];for(let t=0;t<u;t++)n.push(e.jsx("div",{className:"h-10"},`empty-${t}`));for(let t=1;t<=v;t++){const s=t===f&&l===p&&i===j,a=o[t]||[],m=c(a),r=N(a);n.push(e.jsxs("div",{className:`h-10 flex flex-col items-center justify-center rounded-md cursor-pointer transition-all ${s?"bg-gray-900 text-white font-semibold":m||"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx("span",{className:"text-sm",children:t}),r&&!s&&e.jsx("div",{className:`w-1 h-1 rounded-full ${r} mt-0.5`})]},t))}const d=["January","February","March","April","May","June","July","August","September","October","November","December"];return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900",children:[d[l]," ",i]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:w,className:"text-xs px-2 py-1 text-blue-600 bg-blue-50 border border-blue-200 rounded hover:bg-blue-100 transition-colors",children:"Today"}),e.jsx("button",{onClick:()=>b("prev"),className:"p-1.5 rounded hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:()=>b("next"),className:"p-1.5 rounded hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})})]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-3",children:["S","M","T","W","T","F","S"].map((t,s)=>e.jsx("div",{className:"text-center text-xs font-semibold text-gray-500",children:t},s))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:n})]})};function S({schedules:x,todaysCollections:g,inProgress:h,completedTotal:f}){const p=new Date().getHours(),j=p<12?"Good morning":p<18?"Good afternoon":"Good evening",[l,i]=y.useState(!1),[v,u]=y.useState(!1),[o,c]=y.useState({type:"all",start_date:"",end_date:""}),N=n=>{if(!n||n.length===0)return"";const d=Object.keys(n[0]),t=d.join(","),s=n.map(a=>d.map(m=>{const r=a[m];if(r==null)return"";const C=String(r);return C.includes(",")?`"${C}"`:C}).join(","));return[t,...s].join(`
`)},b=(n,d)=>{const t=new Blob([n],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),a=URL.createObjectURL(t);s.setAttribute("href",a),s.setAttribute("download",d),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)},w=async()=>{i(!0);try{const n=await k.post("/admin/generate-report",o);if(n.data.success){const d=N(n.data.data),t=new Date().toISOString().split("T")[0],s=`GarbCollect_Report_${o.type}_${t}.csv`;b(d,s),u(!1),c({type:"all",start_date:"",end_date:""})}}catch(n){console.error("Error generating report:",n),alert("Failed to generate report. Please try again.")}finally{i(!1)}};return e.jsxs(e.Fragment,{children:[v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Generate Collection Report"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Report Type"}),e.jsxs("select",{value:o.type,onChange:n=>c({...o,type:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900",children:[e.jsx("option",{value:"all",children:"All Collections"}),e.jsx("option",{value:"completed",children:"Completed Only"}),e.jsx("option",{value:"active",children:"Active Only"}),e.jsx("option",{value:"failed",children:"Failed Only"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date (Optional)"}),e.jsx("input",{type:"date",value:o.start_date,onChange:n=>c({...o,start_date:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date (Optional)"}),e.jsx("input",{type:"date",value:o.end_date,onChange:n=>c({...o,end_date:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:w,disabled:l,className:"flex-1 inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-gray-900 border border-gray-900 rounded-md hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download Report"]})}),e.jsx("button",{onClick:()=>{u(!1),c({type:"all",start_date:"",end_date:""})},disabled:l,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:j}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Welcome back, Admin"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Here's what's happening with your waste collection operations today."}),e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsxs("button",{onClick:()=>u(!0),className:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-gray-900 border border-gray-900 rounded-md hover:bg-gray-800 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),"Generate Reports"]})})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Today's Collections"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:g||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"In Progress"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:h||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:f||0})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(D,{schedules:x})})]})]})}export{S as WelcomeHero};
