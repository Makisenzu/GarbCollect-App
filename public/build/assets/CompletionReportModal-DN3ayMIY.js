import{r as i,a as N,j as e,S as E}from"./app-CJ4SoJUS.js";function T({isOpen:m,onClose:b,scheduleId:v,scheduleName:K,onSubmitSuccess:p}){const[M,w]=i.useState([]),[n,x]=i.useState([]),[u,h]=i.useState(null),[f,y]=i.useState(null),[g,d]=i.useState(!1),[o,c]=i.useState({});i.useEffect(()=>{m&&k()},[m]);const k=async()=>{try{const s=await N.get("/api/garbage-types");if(s.data.success){const t=s.data.data;w(t),x(t.map(r=>({garbage_id:r.id,garbage_type:r.garbage_type,kilograms:0})))}}catch(s){console.error("Error fetching garbage types:",s)}},C=(s,t)=>{const r=parseFloat(t)||0;x(a=>a.map(l=>l.garbage_id===s?{...l,kilograms:r}:l))},j=(s,t)=>{x(r=>r.map(a=>a.garbage_id===s?{...a,kilograms:Math.max(0,a.kilograms+t)}:a))},P=s=>{const t=s.target.files[0];t&&(h(t),y(URL.createObjectURL(t)))},S=async s=>{var t,r;s.preventDefault(),c({}),d(!0);try{if(!u){c({picture:"Report picture is required"}),d(!1);return}if(n.reduce((_,R)=>_+R.kilograms,0)===0){c({kilograms:"Please enter at least one garbage weight"}),d(!1);return}const l=new FormData;l.append("schedule_id",v),l.append("report_picture",u),l.append("reports",JSON.stringify(n)),(await N.post("/submit-completion-report",l,{headers:{"Content-Type":"multipart/form-data"}})).data.success&&(console.log("âœ… Completion report submitted successfully"),p&&p(),E.visit("/driver/task"))}catch(a){console.error("Error submitting report:",a),c({submit:((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to submit report. Please try again."})}finally{d(!1)}};return m?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[9999] flex items-center justify-center p-3 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[95vh] sm:max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold",children:"ðŸŽ‰ Collection Completed!"}),e.jsx("p",{className:"text-green-100 text-xs sm:text-sm mt-1",children:"Please submit your collection report"})]}),e.jsx("button",{onClick:b,className:"ml-2 p-2 hover:bg-green-700 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("form",{onSubmit:S,className:"p-4 sm:p-6 overflow-y-auto max-h-[calc(95vh-180px)] sm:max-h-[calc(90vh-200px)]",children:[o.submit&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:o.submit}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Collection Report Picture ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center",children:f?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:f,alt:"Preview",className:"max-h-40 sm:max-h-48 mx-auto rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>{h(null),y(null)},className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1.5 sm:p-2 hover:bg-red-600",children:"âœ•"})]}):e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl sm:text-4xl mb-2",children:"ðŸ“·"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("span",{className:"text-blue-600 hover:text-blue-700 font-medium text-sm sm:text-base",children:"Click to upload picture"}),e.jsx("input",{type:"file",accept:"image/*",onChange:P,className:"hidden"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"PNG, JPG up to 5MB"})]})}),o.picture&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:o.picture})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:["Garbage Collected (Kilograms) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"space-y-3",children:n.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:"ðŸ—‘ï¸"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm sm:text-base truncate",children:s.garbage_type}),e.jsx("div",{className:"text-xs text-gray-500",children:"Kilograms (kg)"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 ml-2",children:[e.jsx("button",{type:"button",onClick:()=>j(s.garbage_id,-.5),className:"w-7 h-7 sm:w-8 sm:h-8 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 font-bold text-sm sm:text-base",children:"-"}),e.jsx("input",{type:"number",step:"0.1",min:"0",value:s.kilograms,onChange:t=>C(s.garbage_id,t.target.value),className:"w-16 sm:w-20 text-center px-2 py-1.5 sm:py-2 border border-gray-300 rounded-lg font-semibold text-sm sm:text-base"}),e.jsx("button",{type:"button",onClick:()=>j(s.garbage_id,.5),className:"w-7 h-7 sm:w-8 sm:h-8 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 font-bold text-sm sm:text-base",children:"+"})]})]},s.garbage_id))}),o.kilograms&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:o.kilograms})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 sm:p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-700 text-sm sm:text-base",children:"Total Collected:"}),e.jsxs("span",{className:"text-xl sm:text-2xl font-bold text-blue-600",children:[n.reduce((s,t)=>s+t.kilograms,0).toFixed(2)," kg"]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("button",{type:"button",onClick:b,disabled:g,className:"flex-1 px-4 sm:px-6 py-2.5 sm:py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-base",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:g,className:"flex-1 px-4 sm:px-6 py-2.5 sm:py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg hover:from-green-700 hover:to-emerald-700 font-semibold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-base",children:g?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 sm:h-5 sm:w-5",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Submitting..."]}):"Submit Report & Complete"})]}),e.jsx("div",{className:"mt-4 p-2.5 sm:p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-yellow-800",children:[e.jsx("span",{className:"font-semibold",children:"Note:"})," After submitting this report, the schedule will be marked as completed and you'll be redirected to the dashboard."]})})]})]})}):null}export{T as default};
