import{r as d,j as e}from"./app-DomsZQZz.js";import{M as U}from"./map-pin-CQVU8iUD.js";import{C as V}from"./circle-alert-DB3gMui-.js";import{C as z}from"./calendar-BBw2rngB.js";import{C as K}from"./clock-DIQv3PIQ.js";import{c as X}from"./createLucideIcon-CB44n88a.js";import{E as q}from"./eye-C4Zg7o-p.js";import{X as G}from"./x-CIKvk1Rd.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Q=X("play",J);function ie({drivers:n,barangays:f,schedules:u,onStartTask:D,mapboxKey:k}){var $,A;const[b,S]=d.useState("today"),[p,y]=d.useState([]),[N,h]=d.useState(!1),[s,m]=d.useState(new Date),[j,w]=d.useState(null),[M,T]=d.useState(!1),C=n.length>0?($=n[0])==null?void 0:$.barangay:null,v=(C==null?void 0:C.id)||(u.length>0?(A=u[0])==null?void 0:A.barangay_id:null);d.useEffect(()=>{const t=setInterval(()=>{m(new Date)},6e4);return()=>clearInterval(t)},[]);const _=t=>{if(!t.collection_date)return!1;try{const r=new Date(t.collection_date),a=new Date;return r.toDateString()===a.toDateString()}catch{return!1}},P=t=>{if(!t.collection_date||!t.collection_time)return!1;try{const r=s,a=new Date(t.collection_date),[o,x]=t.collection_time.split(":").map(Number),g=new Date(a);return g.setHours(o,x,0,0),r>=g}catch{return!1}},I=t=>{if(!t.collection_date||!t.collection_time)return"Invalid";try{const r=new Date(t.collection_date),[a,o]=t.collection_time.split(":").map(Number);r.setHours(a,o,0,0);const x=s,g=r.getTime()-x.getTime(),c=Math.floor(g/(1e3*60)),l=Math.floor(c/60),i=Math.floor(l/24);return c<0?_(t)?"Now":"Past":c===0?"Now":c<60?`${c}m`:l<24?`${l}h ${c%60}m`:i===1?"Tomorrow":`${i}d`}catch{return"Error"}};d.useEffect(()=>{if(!v){y([]);return}h(!0);let t=u.filter(o=>o.barangay_id==v);const r=s,a=new Date(r.getFullYear(),r.getMonth(),r.getDate());switch(b){case"today":t=t.filter(l=>new Date(l.collection_date).toDateString()===a.toDateString());break;case"week":const o=new Date(a);o.setDate(a.getDate()-a.getDay());const x=new Date(o);x.setDate(o.getDate()+6),t=t.filter(l=>{const i=new Date(l.collection_date);return i>=o&&i<=x});break;case"month":const g=new Date(r.getFullYear(),r.getMonth(),1),c=new Date(r.getFullYear(),r.getMonth()+1,0);t=t.filter(l=>{const i=new Date(l.collection_date);return i>=g&&i<=c});break}y(t),h(!1)},[v,b,u,s]);const F=t=>{const r=_(t),a=P(t),o=t.status==="active"||t.status==="pending"||t.status==="in_progress"||t.status==="progress";return r&&a&&o},E=async t=>{if(confirm("Are you sure you want to finish this task? This will open the completion report modal."))try{window.showCompletionReportModal?window.showCompletionReportModal(t.id):alert("Please complete all sites first before finishing the task.")}catch(r){console.error("Error finishing task:",r),alert("Failed to finish task. Please try again.")}},L=t=>{w(t),T(!0)},B=()=>{T(!1),w(null)},H=t=>{if(!t)return"N/A";try{return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch{return"Invalid"}},O=t=>{if(!t)return"N/A";try{const[r,a]=t.split(":").map(Number),o=r>=12?"PM":"AM";return`${r%12||12}:${a.toString().padStart(2,"0")} ${o}`}catch{return t}},W=t=>{const a={in_progress:{color:"bg-amber-100 text-amber-800 border-amber-200",label:"In Progress"},active:{color:"bg-blue-100 text-blue-800 border-blue-200",label:"Active"},inactive:{color:"bg-gray-100 text-gray-800 border-gray-200",label:"Inactive"},completed:{color:"bg-green-100 text-green-800 border-green-200",label:"Completed"},done:{color:"bg-green-100 text-green-800 border-green-200",label:"Done"},failed:{color:"bg-red-100 text-red-800 border-red-200",label:"Failed"},pending:{color:"bg-amber-100 text-amber-800 border-amber-200",label:"Pending"}}[t]||{color:"bg-gray-100 text-gray-800 border-gray-200",label:t};return e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border ${a.color}`,children:a.label})},Y=({schedule:t})=>{const r=_(t),a=F(t),o=I(t);return e.jsx("div",{className:`bg-white rounded-xl border hover:shadow-lg transition-all duration-200 overflow-hidden ${r?"border-blue-300 bg-gradient-to-br from-blue-50 to-white":"border-gray-200"}`,children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(z,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:H(t.collection_date)}),r&&e.jsx("span",{className:"text-xs bg-blue-600 text-white px-2.5 py-1 rounded-full font-medium",children:"Today"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(K,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:O(t.collection_time)}),!a&&e.jsx("span",{className:"text-xs bg-amber-100 text-amber-700 px-2.5 py-1 rounded-full font-medium",children:o})]})]}),W(t.status)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("button",{onClick:()=>a&&D(t),disabled:!a,className:`flex-1 flex items-center justify-center gap-2 px-3 sm:px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ${a?"bg-gradient-to-r from-green-600 to-green-700 text-white hover:from-green-700 hover:to-green-800 shadow-sm hover:shadow-md":"bg-gray-100 text-gray-400 cursor-not-allowed border border-gray-200"}`,children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:a?"Start Task":"Not Available"}),e.jsx("span",{className:"sm:hidden",children:a?"Start":"N/A"})]}),t.status==="in_progress"&&e.jsxs("button",{onClick:()=>E(t),className:"flex-1 flex items-center justify-center gap-2 px-3 sm:px-4 py-2.5 bg-gradient-to-r from-orange-600 to-orange-700 text-white rounded-lg text-sm font-medium hover:from-orange-700 hover:to-orange-800 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),"Finish"]}),e.jsxs("button",{onClick:()=>L(t),className:"flex-1 flex items-center justify-center gap-2 px-3 sm:px-4 py-2.5 bg-white border border-blue-300 text-blue-600 rounded-lg text-sm font-medium hover:bg-blue-50 transition-colors",children:[e.jsx(q,{className:"w-4 h-4"}),"Details"]})]})]})})},R=[{value:"today",label:"Today"},{value:"week",label:"Week"},{value:"month",label:"Month"}];return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Collection Schedules"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage your waste collection tasks"})]}),e.jsx("div",{className:"flex gap-2",children:R.map(t=>e.jsx("button",{onClick:()=>S(t.value),className:`flex-1 px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ${b===t.value?"bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-sm":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:t.label},t.value))}),v?N?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-blue-600 border-t-transparent"})}):p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(V,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-1",children:"No Schedules Found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No collection tasks for this period"})]}):e.jsx("div",{className:"space-y-4",children:p.map(t=>e.jsx(Y,{schedule:t},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(U,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-1",children:"No Assigned Barangay"}),e.jsx("p",{className:"text-sm text-gray-500",children:"You haven't been assigned to any barangay yet"})]})]}),M&&j&&e.jsx(Z,{schedule:j,onClose:B,barangays:f})]})}const Z=({schedule:n,onClose:f,barangays:u})=>{var N,h;const D=((N=n.barangay)==null?void 0:N.baranggay_name)||"N/A",k=((h=n.collections)==null?void 0:h.length)||0,b=s=>{if(!s)return"N/A";try{return new Date(s).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch{return"Invalid Date"}},S=s=>{if(!s)return"N/A";try{const[m,j]=s.split(":").map(Number),w=m>=12?"PM":"AM";return`${m%12||12}:${j.toString().padStart(2,"0")} ${w}`}catch{return s}},p=s=>s==="in_progress"||s==="progress"?"In Progress":s.charAt(0).toUpperCase()+s.slice(1),y=s=>{switch(s){case"completed":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"in_progress":case"progress":return"bg-blue-50 text-blue-700 border-blue-200";case"active":return"bg-amber-50 text-amber-700 border-amber-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}};return e.jsx("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"relative bg-gradient-to-br from-slate-800 via-slate-700 to-slate-800 px-8 py-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white tracking-tight",children:"Schedule Details"}),e.jsx("p",{className:"text-slate-300 text-sm mt-1.5 font-medium",children:"Collection Schedule Information"})]}),e.jsx("button",{onClick:f,className:"ml-4 p-2 text-slate-300 hover:text-white hover:bg-slate-600 rounded-lg transition-all duration-200","aria-label":"Close modal",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-500 via-indigo-500 to-blue-500"})]}),e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2",children:"Barangay"}),e.jsx("div",{className:"text-xl font-semibold text-gray-900 bg-gray-50 px-4 py-3 rounded-lg border border-gray-200",children:D})]}),e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2",children:"Total Collection Sites"}),e.jsx("div",{className:"text-xl font-semibold text-gray-900 bg-gray-50 px-4 py-3 rounded-lg border border-gray-200",children:k>0?`${k} Sites`:"No Sites Assigned"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2",children:"Collection Date"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900 bg-gray-50 px-4 py-3 rounded-lg border border-gray-200",children:b(n.collection_date)})]}),e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2",children:"Collection Time"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900 bg-gray-50 px-4 py-3 rounded-lg border border-gray-200",children:S(n.collection_time)})]})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2",children:"Current Status"}),e.jsxs("div",{className:`inline-flex items-center px-4 py-2 rounded-lg border font-semibold text-sm ${y(n.status)}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${n.status==="completed"?"bg-emerald-500":n.status==="in_progress"||n.status==="progress"?"bg-blue-500 animate-pulse":n.status==="active"?"bg-amber-500":"bg-gray-500"}`}),p(n.status)]})]})]})}),e.jsx("div",{className:"bg-gray-50 px-8 py-5 border-t border-gray-200 flex gap-3",children:e.jsx("button",{onClick:f,className:"flex-1 px-6 py-3 bg-slate-700 text-white rounded-lg font-semibold hover:bg-slate-800 active:bg-slate-900 transition-all duration-200 shadow-sm hover:shadow-md",children:"Close"})})]})})};export{ie as default};
