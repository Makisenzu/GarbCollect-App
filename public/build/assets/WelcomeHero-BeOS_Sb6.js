import{r as j,j as e,a as C}from"./app-Fn98fs5j.js";const D=({schedules:u})=>{const[g,y]=j.useState(new Date),h=new Date().getDate(),f=new Date().getMonth(),v=new Date().getFullYear(),i=g.getMonth(),o=g.getFullYear(),c=new Date(o,i+1,0).getDate(),N=new Date(o,i,1).getDay(),x={};u&&Array.isArray(u)&&u.forEach(t=>{const n=new Date(t.collection_date);if(n.getMonth()===i&&n.getFullYear()===o){const s=n.getDate();x[s]||(x[s]=[]),x[s].push(t)}});const w=t=>{if(!t||t.length===0)return"";const n=t.some(a=>a.status==="FAILED"),s=t.some(a=>a.status==="completed"),b=t.some(a=>a.status==="active"||a.status==="pending");return n?"bg-red-50 text-red-700 border border-red-200":s?"bg-green-50 text-green-700 border border-green-200":b?"bg-blue-50 text-blue-700 border border-blue-200":""},r=t=>{if(!t||t.length===0)return null;const n=t.some(a=>a.status==="FAILED"),s=t.some(a=>a.status==="completed"),b=t.some(a=>a.status==="active"||a.status==="pending");return n?"bg-red-500":s?"bg-green-500":b?"bg-blue-500":null},d=t=>{y(n=>{const s=new Date(n);return t==="next"?s.setMonth(s.getMonth()+1):s.setMonth(s.getMonth()-1),s})},m=()=>{y(new Date)},l=[];for(let t=0;t<N;t++)l.push(e.jsx("div",{className:"h-10"},`empty-${t}`));for(let t=1;t<=c;t++){const n=t===h&&i===f&&o===v,s=x[t]||[],b=w(s),a=r(s);l.push(e.jsxs("div",{className:`h-10 flex flex-col items-center justify-center rounded-md cursor-pointer transition-all ${n?"bg-gray-900 text-white font-semibold":b||"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx("span",{className:"text-sm",children:t}),a&&!n&&e.jsx("div",{className:`w-1 h-1 rounded-full ${a} mt-0.5`})]},t))}const p=["January","February","March","April","May","June","July","August","September","October","November","December"];return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900",children:[p[i]," ",o]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:m,className:"text-xs px-2 py-1 text-blue-600 bg-blue-50 border border-blue-200 rounded hover:bg-blue-100 transition-colors",children:"Today"}),e.jsx("button",{onClick:()=>d("prev"),className:"p-1.5 rounded hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:()=>d("next"),className:"p-1.5 rounded hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})})]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-3",children:["S","M","T","W","T","F","S"].map((t,n)=>e.jsx("div",{className:"text-center text-xs font-semibold text-gray-500",children:t},n))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:l})]})};function M({schedules:u}){const g=new Date().getHours(),y=g<12?"Good morning":g<18?"Good afternoon":"Good evening",[h,f]=j.useState(!1),[v,i]=j.useState(!1),[o,c]=j.useState({type:"all",start_date:"",end_date:""}),N=r=>{if(!r||r.length===0)return"";const d=Object.keys(r[0]),m=d.join(","),l=r.map(p=>d.map(t=>{const n=p[t];if(n==null)return"";const s=String(n);return s.includes(",")?`"${s}"`:s}).join(","));return[m,...l].join(`
`)},x=(r,d)=>{const m=new Blob([r],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),p=URL.createObjectURL(m);l.setAttribute("href",p),l.setAttribute("download",d),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)},w=async()=>{f(!0);try{const r=await C.post("/admin/generate-report",o);if(r.data.success){const d=N(r.data.data),m=new Date().toISOString().split("T")[0],l=`GarbCollect_Report_${o.type}_${m}.csv`;x(d,l),i(!1),c({type:"all",start_date:"",end_date:""})}}catch(r){console.error("Error generating report:",r),alert("Failed to generate report. Please try again.")}finally{f(!1)}};return e.jsxs(e.Fragment,{children:[v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Generate Collection Report"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Report Type"}),e.jsxs("select",{value:o.type,onChange:r=>c({...o,type:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900",children:[e.jsx("option",{value:"all",children:"All Collections"}),e.jsx("option",{value:"completed",children:"Completed Only"}),e.jsx("option",{value:"active",children:"Active Only"}),e.jsx("option",{value:"FAILED",children:"Failed Only"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date (Optional)"}),e.jsx("input",{type:"date",value:o.start_date,onChange:r=>c({...o,start_date:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date (Optional)"}),e.jsx("input",{type:"date",value:o.end_date,onChange:r=>c({...o,end_date:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:w,disabled:h,className:"flex-1 inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-gray-900 border border-gray-900 rounded-md hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:h?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download Report"]})}),e.jsx("button",{onClick:()=>{i(!1),c({type:"all",start_date:"",end_date:""})},disabled:h,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:y}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Welcome back, Admin"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Here's what's happening with your waste collection operations today."}),e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsxs("button",{onClick:()=>i(!0),className:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-gray-900 border border-gray-900 rounded-md hover:bg-gray-800 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),"Generate Reports"]})})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Today's Collections"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"24"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"In Progress"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:"8"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:"16"})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(D,{schedules:u})})]})]})}export{M as WelcomeHero};
