import{r as s,c as G,j as e,a as I}from"./app-DWmdmgul.js";import{a as i}from"./mapbox-gl-BJ1pdNV_.js";import{G as H}from"./index-RWf_bFlR.js";import{G as O}from"./iconBase-BUBEJkVO.js";import{G as j}from"./index-Cu_ngbiz.js";function L(o){return O({attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8 0c-2.761 0-5 2.239-5 5 0 5 5 11 5 11s5-6 5-11c0-2.761-2.239-5-5-5zM8 8c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3z"},child:[]}]})(o)}function X({mapboxKey:o,onLocationSelect:V}){const u=s.useRef(null),t=s.useRef(null),m=s.useRef([]),[p,N]=s.useState(!1),[d,v]=s.useState([]),[g,f]=s.useState(!1),[q,D]=s.useState(null),B={Alegria:"#FF5733","Barangay 1":"#33FF57","Barangay 2":"#3357FF","Barangay 3":"#F033FF","Barangay 4":"#FF33F0","Barangay 5":"#33FFF0","Bayugan 2":"#8A2BE2","Bitan-agan":"#A52A2A",Borbon:"#DEB887",Buenasuerte:"#5F9EA0",Caimpugan:"#7FFF00","Das-agan":"#D2691E",Ebro:"#FF7F50",Hubang:"#6495ED",Karaus:"#DC143C",Ladgadan:"#00FFFF",Lapinigan:"#00008B",Lucac:"#008B8B",Mate:"#B8860B","New Visayas":"#006400",Ormaca:"#8B008B",Pasta:"#556B2F","Pisa-an":"#FF8C00",Rizal:"#9932CC","San Isidro":"#8FBC8F","Santa Ana":"#483D8B",Tagapua:"#2F4F4F",_default:"#4F262A"},_=Object.keys(B).filter(a=>a!=="_default");s.useEffect(()=>{const a=document.createElement("link");return a.href="https://api.mapbox.com/mapbox-gl-js/v3.0.0/mapbox-gl.css",a.rel="stylesheet",document.head.appendChild(a),N(!0),()=>{document.head.removeChild(a)}},[]),s.useEffect(()=>{(async()=>{try{const n=await I.get("/municipality/barangay/purok/sites");n.data.success&&v(n.data.data)}catch(n){console.error("Error fetching locations: ",n)}})()},[]),s.useEffect(()=>{if(!(!p||!o||t.current||!u.current))return i.accessToken=o,t.current=new i.Map({container:u.current,style:"mapbox://styles/makisenpai/cm9mo7odu006c01qsc3931nj7",center:[125.9766649,8.50410607],attributionControl:!1,zoom:13}),t.current.on("load",()=>{f(!0)}),()=>{t.current&&(t.current.remove(),t.current=null),f(!1)}},[o,p]),s.useEffect(()=>{g&&d.length>0&&M()},[g,d]);const M=()=>{S(),d.forEach(a=>{if(a.longitude&&a.latitude){const n=z([parseFloat(a.longitude),parseFloat(a.latitude)],"site",a.site_name,a);m.current.push(n)}})},S=()=>{m.current.forEach(a=>{a._root&&a._root.unmount(),a.remove()}),m.current=[]},z=(a,n="manual",h="",r=null)=>{var C,E,k,w,A;const F=document.createElement("div");F.className="custom-marker";const x={Alegria:"#FF5733","Barangay 1":"#33FF57","Barangay 2":"#3357FF","Barangay 3":"#F033FF","Barangay 4":"#FF33F0","Barangay 5":"#33FFF0","Bayugan 2":"#8A2BE2","Bitan-agan":"#A52A2A",Borbon:"#DEB887",Buenasuerte:"#5F9EA0",Caimpugan:"#7FFF00","Das-agan":"#D2691E",Ebro:"#FF7F50",Hubang:"#6495ED",Karaus:"#DC143C",Ladgadan:"#00FFFF",Lapinigan:"#00008B",Lucac:"#008B8B",Mate:"#B8860B","New Visayas":"#006400",Ormaca:"#8B008B",Pasta:"#556B2F","Pisa-an":"#FF8C00",Rizal:"#9932CC","San Isidro":"#8FBC8F","Santa Ana":"#483D8B",Tagapua:"#2F4F4F",_default:"#4F262A"};let y="";const R=(E=(C=r.purok)==null?void 0:C.baranggay)==null?void 0:E.baranggay_name,P=(r==null?void 0:r.type)||"site";y=x[R]||x._default;const b=n==="site"?30:15,c=G.createRoot(F);n==="manual"?c.render(e.jsx(H,{size:15,color:"#FC2622"})):P==="station"?c.render(e.jsx(j,{size:b,color:"#4F262A"})):c.render(e.jsx(L,{size:b,color:y}));const l=new i.Marker({element:F,draggable:!1}).setLngLat(a).addTo(t.current);if(n==="site"&&h){const T=`
                <div class="p-2">
                    <h3 class="font-bold">${h}</h3>
                    ${r?`
                        <p><strong>Site #: </strong>${r.id}</p>
                        <p><strong>Barangay:</strong> ${((w=(k=r.purok)==null?void 0:k.baranggay)==null?void 0:w.baranggay_name)||"N/A"}</p>
                        <p><strong>Purok:</strong> ${((A=r.purok)==null?void 0:A.purok_name)||"N/A"}</p>
                        ${r.additional_notes?`<p><strong>Notes:</strong> ${r.additional_notes}</p>`:"<p><strong>Notes:</strong> None</storn></p>"}
                    `:""}
                </div>
            `,$=new i.Popup({offset:25}).setHTML(T);l.setPopup($)}return n==="manual"&&(markerRef.current=l),l._root=c,l};return e.jsxs("div",{className:"relative w-full h-full rounded-lg",children:[e.jsx("div",{ref:u,className:"w-full h-full rounded-lg"}),e.jsxs("div",{className:`absolute bottom-4 right-4 bg-white p-2 sm:p-4 rounded-lg shadow-md z-40 
                          max-h-[100px] sm:max-h-[150px] w-[160px] sm:w-[220px] overflow-y-auto
                          text-xs sm:text-sm`,children:[e.jsx("h3",{className:"font-bold mb-2 sticky top-0 bg-white pb-2",children:"Map Legend"}),e.jsxs("div",{className:"space-y-1 sm:space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{className:"w-4 h-4 sm:w-5 sm:h-5",color:"#4F262A"}),e.jsx("span",{className:"ml-2",children:"Station"})]}),_.map(a=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"w-4 h-4 sm:w-5 sm:h-5",color:B[a]}),e.jsx("span",{className:"ml-2 truncate",children:a})]},a))]})]})]})}export{X as default};
