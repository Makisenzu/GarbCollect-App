import{r as d,j as t}from"./app-B7J0SWTz.js";import{M as E}from"./map-pin-DUaZoSGO.js";import{C as F}from"./circle-alert-CcE0yZH2.js";import{C as O}from"./calendar-JtNrkwmK.js";import{C as Y}from"./clock-PsJtUhwZ.js";import{c as B}from"./createLucideIcon-CP_FA1e8.js";import{E as H}from"./eye-BX2m3aw8.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],W=B("play",L);function X({drivers:h,barangays:V,schedules:m,onStartTask:v,mapboxKey:z}){var N,j;const[x,D]=d.useState("today"),[y,p]=d.useState([]),[S,w]=d.useState(!1),[u,_]=d.useState(new Date),b=h.length>0?(N=h[0])==null?void 0:N.barangay:null,g=(b==null?void 0:b.id)||(m.length>0?(j=m[0])==null?void 0:j.barangay_id:null);d.useEffect(()=>{const e=setInterval(()=>{_(new Date)},6e4);return()=>clearInterval(e)},[]);const f=e=>{if(!e.collection_date)return!1;try{const r=new Date(e.collection_date),a=new Date;return r.toDateString()===a.toDateString()}catch{return!1}},T=e=>{if(!e.collection_date||!e.collection_time)return!1;try{const r=u,a=new Date(e.collection_date),[s,i]=e.collection_time.split(":").map(Number),c=new Date(a);return c.setHours(s,i,0,0),r>=c}catch{return!1}},M=e=>{if(!e.collection_date||!e.collection_time)return"Invalid";try{const r=new Date(e.collection_date),[a,s]=e.collection_time.split(":").map(Number);r.setHours(a,s,0,0);const i=u,c=r.getTime()-i.getTime(),l=Math.floor(c/(1e3*60)),o=Math.floor(l/60),n=Math.floor(o/24);return l<0?f(e)?"Now":"Past":l===0?"Now":l<60?`${l}m`:o<24?`${o}h ${l%60}m`:n===1?"Tomorrow":`${n}d`}catch{return"Error"}};d.useEffect(()=>{if(!g){p([]);return}w(!0);let e=m.filter(s=>s.barangay_id==g);const r=u,a=new Date(r.getFullYear(),r.getMonth(),r.getDate());switch(x){case"today":e=e.filter(o=>new Date(o.collection_date).toDateString()===a.toDateString());break;case"week":const s=new Date(a);s.setDate(a.getDate()-a.getDay());const i=new Date(s);i.setDate(s.getDate()+6),e=e.filter(o=>{const n=new Date(o.collection_date);return n>=s&&n<=i});break;case"month":const c=new Date(r.getFullYear(),r.getMonth(),1),l=new Date(r.getFullYear(),r.getMonth()+1,0);e=e.filter(o=>{const n=new Date(o.collection_date);return n>=c&&n<=l});break}p(e),w(!1)},[g,x,m,u]);const k=e=>{const r=f(e),a=T(e),s=e.status==="active"||e.status==="pending"||e.status==="in_progress"||e.status==="progress";return r&&a&&s},C=e=>{if(!e)return"N/A";try{return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch{return"Invalid"}},$=e=>{if(!e)return"N/A";try{const[r,a]=e.split(":").map(Number),s=r>=12?"PM":"AM";return`${r%12||12}:${a.toString().padStart(2,"0")} ${s}`}catch{return e}},P=e=>{const a={in_progress:{color:"bg-amber-100 text-amber-800 border-amber-200",label:"In Progress"},active:{color:"bg-blue-100 text-blue-800 border-blue-200",label:"Active"},inactive:{color:"bg-gray-100 text-gray-800 border-gray-200",label:"Inactive"},completed:{color:"bg-green-100 text-green-800 border-green-200",label:"Completed"},done:{color:"bg-green-100 text-green-800 border-green-200",label:"Done"},failed:{color:"bg-red-100 text-red-800 border-red-200",label:"Failed"},pending:{color:"bg-amber-100 text-amber-800 border-amber-200",label:"Pending"}}[e]||{color:"bg-gray-100 text-gray-800 border-gray-200",label:e};return t.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border ${a.color}`,children:a.label})},A=({schedule:e})=>{const r=f(e),a=k(e),s=M(e);return t.jsx("div",{className:`bg-white rounded-xl border hover:shadow-lg transition-all duration-200 overflow-hidden ${r?"border-blue-300 bg-gradient-to-br from-blue-50 to-white":"border-gray-200"}`,children:t.jsxs("div",{className:"p-5",children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(O,{className:"w-4 h-4 text-gray-500"}),t.jsx("span",{className:"text-sm font-semibold text-gray-900",children:C(e.collection_date)}),r&&t.jsx("span",{className:"text-xs bg-blue-600 text-white px-2.5 py-1 rounded-full font-medium",children:"Today"})]}),t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(Y,{className:"w-4 h-4 text-gray-500"}),t.jsx("span",{className:"text-sm text-gray-700",children:$(e.collection_time)}),!a&&t.jsx("span",{className:"text-xs bg-amber-100 text-amber-700 px-2.5 py-1 rounded-full font-medium",children:s})]})]}),P(e.status)]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>a&&v(e),disabled:!a,className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ${a?"bg-gradient-to-r from-green-600 to-green-700 text-white hover:from-green-700 hover:to-green-800 shadow-sm hover:shadow-md":"bg-gray-100 text-gray-400 cursor-not-allowed border border-gray-200"}`,children:[t.jsx(W,{className:"w-4 h-4"}),a?"Start Task":"Not Available"]}),t.jsxs("button",{className:"flex items-center justify-center gap-2 px-4 py-2.5 bg-white border border-blue-300 text-blue-600 rounded-lg text-sm font-medium hover:bg-blue-50 transition-colors",children:[t.jsx(H,{className:"w-4 h-4"}),"Details"]})]})]})})},I=[{value:"today",label:"Today"},{value:"week",label:"Week"},{value:"month",label:"Month"}];return t.jsx("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Collection Schedules"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Manage your waste collection tasks"})]}),t.jsx("div",{className:"flex gap-2",children:I.map(e=>t.jsx("button",{onClick:()=>D(e.value),className:`flex-1 px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ${x===e.value?"bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-sm":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:e.label},e.value))}),g?S?t.jsx("div",{className:"flex justify-center items-center py-12",children:t.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-blue-600 border-t-transparent"})}):y.length===0?t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(F,{className:"w-8 h-8 text-gray-400"})}),t.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-1",children:"No Schedules Found"}),t.jsx("p",{className:"text-sm text-gray-500",children:"No collection tasks for this period"})]}):t.jsx("div",{className:"space-y-4",children:y.map(e=>t.jsx(A,{schedule:e},e.id))}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(E,{className:"w-8 h-8 text-gray-400"})}),t.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-1",children:"No Assigned Barangay"}),t.jsx("p",{className:"text-sm text-gray-500",children:"You haven't been assigned to any barangay yet"})]})]})})}export{X as default};
