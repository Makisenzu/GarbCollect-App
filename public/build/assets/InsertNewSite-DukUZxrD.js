import{r,j as e,x as A,a as f}from"./app-C7VlHLTB.js";import{I as u}from"./InputError-FvQvKJCn.js";import{I as d}from"./InputLabel-BzS-wn7J.js";import{P as H}from"./PrimaryButton-DV20kFqt.js";import{T as q}from"./TextInput-BxLQoxZG.js";import{G as D}from"./iconBase-y9HBB7Zl.js";import{s as L,S as V}from"./SweetAlert-CqxvEp8X.js";import{C as G}from"./index-CZPjooZx.js";import{S as B}from"./react-select.esm-Mar7lqIz.js";import{z as W}from"./transition-LJuDDrJC.js";import"./index-CnyDuYXe.js";import"./index-DCduvhAn.js";const R=({initialValue:m=!1,onChange:i,yesLabel:g="Yes",noLabel:a="No",disabled:t=!1})=>{const[o,n]=r.useState(m),p=()=>{if(t)return;const x=!o;n(x),i&&i(x)};return e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`mr-2 text-sm font-medium ${o?"text-gray-400":"text-gray-900"}`,children:a}),e.jsx("button",{type:"button",className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors 
          focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2
          ${t?"cursor-not-allowed opacity-50":"cursor-pointer"}
          ${o?"bg-indigo-600":"bg-gray-200"}`,onClick:p,disabled:t,"aria-pressed":o,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform
            ${o?"translate-x-6":"translate-x-1"}`})}),e.jsx("span",{className:`ml-2 text-sm font-medium ${o?"text-gray-900":"text-gray-400"}`,children:g})]})};function K(m){return D({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},child:[]},{tag:"polyline",attr:{points:"22 4 12 14.01 9 11.01"},child:[]}]})(m)}function oe({onSiteAdded:m,selectedLocation:i,trucks:g=[]}){const{data:a,setData:t,processing:o,errors:n,reset:p}=A({site_name:"",collection_day:"Monday",type:"site",barangay_id:"",purok_id:"",coordinates:null,truck_id:"",notes:""}),[x,T]=r.useState([]),[z,y]=r.useState([]),[v,b]=r.useState(!1),[j,N]=r.useState(!1),[F,w]=r.useState(!1),[h,I]=r.useState(!1),[P,$]=r.useState("active"),_=z.map(s=>({value:s.id,label:s.purok_name})),k=x.map(s=>({value:s.id,label:s.baranggay_name})),E=s=>{$(s?"active":"inactive")};r.useEffect(()=>{(async l=>{b(!0);try{const c=await f.get(`/${l}/barangay`);T(c.data.barangays||[])}catch(c){console.error("Error fetching barangays:",c)}finally{b(!1)}})(1)},[]),r.useEffect(()=>{i&&t({...a,coordinates:i.coordinates,barangay_id:i.barangay_id||"",purok_id:i.purok_id||""})},[i]),r.useEffect(()=>{(async()=>{if(!a.barangay_id){y([]);return}N(!0);try{const l=await f.get(`/${a.barangay_id}/barangay/purok`);y(l.data.puroks||[])}catch(l){console.error("Error fetching puroks:",l)}finally{N(!1)}})()},[a.barangay_id]);const M=s=>{if(s.preventDefault(),!a.coordinates){L("warning","Location Required","Please select a location on the map first");return}const l={site_name:a.site_name,purok_id:a.purok_id,latitude:a.coordinates.lat,longitude:a.coordinates.lng,type:a.type,status:P,additional_notes:a.notes||null};f.post("/municipality/barangay/addNewGarbageSite",l).then(c=>{V.fire({title:"Success!",text:"Site added successfully",icon:"success",draggable:!0,confirmButtonText:"OK"}),p(),w(!0),setTimeout(()=>w(!1),2e3),m&&setTimeout(()=>{m({...a,coordinates:a.coordinates})},0)}).catch(c=>{var S,C;console.error("Submission error:",c.response),alert(`Error: ${((C=(S=c.response)==null?void 0:S.data)==null?void 0:C.message)||"Failed to save site"}`)})};return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg",children:[e.jsxs("div",{className:"bg-black text-white p-1 rounded-t-lg cursor-pointer flex justify-between items-center",onClick:()=>I(!h),children:[e.jsxs("h2",{className:"text-base font-semibold flex items-center",children:[e.jsx(G,{className:"mr-2",size:18}),"Add New Site"]}),e.jsx("span",{className:"transform transition-transform duration-200",children:h?"▼":"▲"})]}),e.jsx("div",{className:`transition-all duration-300 overflow-hidden ${h?"max-h-0":"max-h-[80vh]"}`,children:e.jsx("div",{className:"p-4 overflow-y-auto",children:e.jsx("form",{onSubmit:M,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"site_name",value:"Site Name *"}),e.jsx(q,{id:"site_name",name:"site_name",value:a.site_name,className:"mt-1 block w-full text-sm",onChange:s=>t("site_name",s.target.value),required:!0}),e.jsx(u,{message:n.site_name,className:"mt-1"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"barangay_id",value:"Barangay *"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(B,{id:"barangay_id",name:"barangay_id",value:k.find(s=>s.value===a.barangay_id)||null,onChange:s=>t("barangay_id",(s==null?void 0:s.value)||""),options:k,placeholder:"Select Barangay",isDisabled:v,required:!0,maxMenuHeight:150,className:"text-sm",styles:{control:s=>({...s,borderColor:"#d1d5db",minHeight:"42px",fontSize:"14px","&:hover":{borderColor:"#d1d5db"},"&:focus":{borderColor:"#6366f1",boxShadow:"0 0 0 1px #6366f1"}})}}),v&&e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsxs("svg",{className:"animate-spin h-4 w-4 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})]}),e.jsx(u,{message:n.barangay_id,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"purok_id",value:"Purok/Sitio *"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(B,{id:"purok_id",name:"purok_id",value:_.find(s=>s.value===a.purok_id)||null,onChange:s=>t("purok_id",(s==null?void 0:s.value)||""),options:_,placeholder:"Select Purok",isDisabled:!a.barangay_id||j,required:!0,maxMenuHeight:150,className:"text-sm",styles:{control:s=>({...s,borderColor:"#d1d5db",minHeight:"42px",fontSize:"14px","&:hover":{borderColor:"#d1d5db"},"&:focus":{borderColor:"#6366f1",boxShadow:"0 0 0 1px #6366f1"}})}}),j&&e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsxs("svg",{className:"animate-spin h-4 w-4 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})]}),e.jsx(u,{message:n.purok_id,className:"mt-1"})]})]}),g.length>0&&e.jsxs("div",{children:[e.jsx(d,{htmlFor:"truck_id",value:"Assigned Truck"}),e.jsxs("select",{id:"truck_id",name:"truck_id",value:a.truck_id,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm py-2",onChange:s=>t("truck_id",s.target.value),children:[e.jsx("option",{value:"",children:"Select a truck"}),g.map(s=>e.jsxs("option",{value:s.id,children:[s.plate_number," (",s.driver_name,")"]},s.id))]}),e.jsx(u,{message:n.truck_id,className:"mt-1"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"type",value:"Collection Type *"}),e.jsxs("select",{id:"type",name:"type",value:a.type,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm py-2",onChange:s=>t("type",s.target.value),required:!0,children:[e.jsx("option",{value:"site",children:"Site"}),e.jsx("option",{value:"station",children:"Station"})]}),e.jsx(u,{message:n.type,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(d,{value:"Status"}),e.jsx("div",{className:"mt-1",children:e.jsx(R,{initialValue:!1,onChange:E,yesLabel:"Active",noLabel:"Inactive",compact:!0})})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"notes",value:"Additional Notes"}),e.jsx("textarea",{id:"notes",name:"notes",value:a.notes,rows:2,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm p-2",onChange:s=>t("notes",s.target.value)}),e.jsx(u,{message:n.notes,className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx(W,{show:F,enter:"transition-opacity duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity duration-300",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("p",{className:"text-sm text-green-600",children:"Site added successfully!"})}),e.jsxs(H,{type:"submit",disabled:o||!a.coordinates,className:"ml-auto text-sm py-2 px-4",children:[e.jsx(K,{size:14,className:"mr-1"}),o?"Saving...":"Save Site"]})]})]})})})})]})}export{oe as default};
