import{J as C,r as n,a as l,S as c,j as e}from"./app-DomsZQZz.js";const T=({scheduleId:o,token:d})=>{const{props:P}=C(),[s,m]=n.useState({garbage_id:"",report_picture:null,sack_count:"",additional_notes:""}),[g,h]=n.useState([]),[f,y]=n.useState(!0),[b,p]=n.useState(!1),[v,j]=n.useState(!1),[x,N]=n.useState(null);n.useEffect(()=>{w(),_()},[o,d]);const w=async()=>{try{(await l.post("/validate-report-token",{schedule_id:o,token:d})).data.valid?j(!0):(alert("Invalid or expired access token. Please complete your route first."),c.visit("/dashboard"))}catch(t){console.error("Token validation error:",t),alert("Error validating access. Please try again."),c.visit("/dashboard")}finally{y(!1)}},_=async()=>{try{const t=await l.get("/garbage-types");h(t.data.data||[])}catch(t){console.error("Error fetching garbage types:",t)}},u=t=>{const{name:a,value:r}=t.target;m(i=>({...i,[a]:r}))},k=t=>{const a=t.target.files[0];if(a){if(!a.type.startsWith("image/")){alert("Please select an image file");return}if(a.size>5*1024*1024){alert("Image size should be less than 5MB");return}m(i=>({...i,report_picture:a}));const r=new FileReader;r.onload=i=>{N(i.target.result)},r.readAsDataURL(a)}},S=async t=>{if(t.preventDefault(),!s.garbage_id||!s.sack_count){alert("Please fill in all required fields");return}if(s.sack_count<0){alert("Sack count cannot be negative");return}p(!0);try{const a=new FormData;a.append("schedule_id",o),a.append("garbage_id",s.garbage_id),a.append("sack_count",s.sack_count),a.append("additional_notes",s.additional_notes||""),s.report_picture&&a.append("report_picture",s.report_picture);const r=await l.post("/submit-report",a,{headers:{"Content-Type":"multipart/form-data"}});r.data.success?(alert("Report submitted successfully!"),await l.post("/invalidate-report-token",{schedule_id:o,token:d}),c.visit("/dashboard")):alert("Failed to submit report: "+(r.data.message||"Unknown error"))}catch(a){console.error("Error submitting report:",a),alert("Error submitting report. Please try again.")}finally{p(!1)}};return f?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Validating access..."})]})}):v?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-green-500 text-6xl mb-4",children:"✅"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Route Completed!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Please submit your collection report"})]}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Garbage Type *"}),e.jsxs("select",{name:"garbage_id",value:s.garbage_id,onChange:u,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Garbage Type"}),g.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Sacks Collected *"}),e.jsx("input",{type:"number",name:"sack_count",value:s.sack_count,onChange:u,min:"0",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter number of sacks"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Collection Photo"}),e.jsx("input",{type:"file",accept:"image/*",onChange:k,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),x&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Preview:"}),e.jsx("img",{src:x,alt:"Preview",className:"max-w-full h-48 object-cover rounded-md border"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),e.jsx("textarea",{name:"additional_notes",value:s.additional_notes,onChange:u,rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Any additional information about the collection..."})]}),e.jsx("button",{type:"submit",disabled:b,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:b?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Submitting..."]}):"Submit Report"})]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"Invalid or expired access token."}),e.jsx("button",{onClick:()=>c.visit("/dashboard"),className:"mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700",children:"Return to Dashboard"})]})})};export{T as default};
