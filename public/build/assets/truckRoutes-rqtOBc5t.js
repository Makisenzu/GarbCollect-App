import{r as s,j as o,Q as A,S as p}from"./app-wN3IebrI.js";import{A as D}from"./AuthenticatedLayout-Cdk3PMKd.js";import I from"./Map-C4baPhWK.js";import M from"./InsertNewSite-CLNvrbje.js";import{F as R}from"./FormModal-DMGqs94_.js";import{c as k,s as i}from"./SweetAlert-BrixZ5p8.js";import"./Dropdown-BIP9Cwoq.js";import"./app-logo-5yzjSYqx.js";import"./transition-CiwQNB9K.js";import"./index-KNQlHpA7.js";import"./iconBase-DQIH54gG.js";import"./index-DSd65ekK.js";import"./index-BqmwqxDI.js";import"./imageHelpers-BzNwYwgf.js";import"./mapbox-gl-CYYTn8lT.js";import"./index-DkWDoonr.js";import"./index-Bm1kQmuP.js";import"./can-3MqaZyCZ.js";import"./InputError-D2OBtRtZ.js";import"./InputLabel-DTmTgei1.js";import"./PrimaryButton-D_gl6crd.js";import"./TextInput-BlG8wfsl.js";import"./react-select.esm-H7Yr4r9w.js";import"./index-CnyDuYXe.js";import"./index-B3cbKWqY.js";function ae({auth:z,mapboxKey:S}){const[h,f]=s.useState(null),[x,g]=s.useState([]),[b,a]=s.useState(0),[m,l]=s.useState(null),[v,n]=s.useState(!1),[y,r]=s.useState({}),[u,c]=s.useState(!1),E=e=>{f(e)},j=e=>{setTimeout(()=>{a(t=>t+1),g(t=>[...t,{lng:e.coordinates.lng,lat:e.coordinates.lat,name:e.site_name,barangay:e.barangay,purok:e.purok}])},0)},w=e=>{l(e),r({site_name:e.site_name||"",status:e.status||"active"}),n(!0)},F=async e=>{if(await k("Delete Site",`Are you sure you want to delete "${e.site_name}"? This action cannot be undone.`,"Delete"))try{await p.delete(`/delete/site/${e.id}`,{preserveScroll:!0,onSuccess:()=>{i("success","Site deleted successfully"),a(d=>d+1)},onError:()=>{i("error","Failed to delete site")}})}catch(d){console.error("Delete error:",d),i("error","Failed to delete site")}},N=async e=>{c(!0);try{await p.patch(`/edit/site/${m.id}`,e,{preserveScroll:!0,onSuccess:()=>{i("success","Site updated successfully"),n(!1),l(null),r({}),a(t=>t+1)},onError:t=>{i("error","Failed to update site")},onFinish:()=>{c(!1)}})}catch(t){console.error("Edit submission error:",t),c(!1)}},T=[{name:"site_name",label:"Site Name",type:"text",required:!0,placeholder:"Enter site name"},{name:"status",label:"Status",type:"select",required:!0,options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"pending",label:"Pending"},{value:"maintenance",label:"Maintenance"}]}];return o.jsxs(D,{children:[o.jsx(A,{title:"Truck Routes"}),o.jsxs("div",{className:"h-screen flex flex-col",children:[o.jsxs("div",{className:"flex-1 relative",children:[o.jsx("div",{className:"absolute inset-0",children:o.jsx(I,{mapboxKey:S||"pk.eyJ1IjoibWFraXNlbnBhaSIsImEiOiJjbTkza3F0NzMwb21tMmxwdzRzYWFncTRoIn0.tRpH1NPUfzt9cvv4IOpxJA",onLocationSelect:E,collectionSites:x,refreshTrigger:b,onEditSite:w,onDeleteSite:F})}),o.jsx("div",{className:"absolute top-2 right-2 left-2 sm:left-auto sm:right-4 sm:top-4 w-auto sm:w-80 max-w-full max-h-[calc(100vh-100px)] overflow-y-auto bg-white rounded-lg shadow-lg z-10",children:o.jsx(M,{onSiteAdded:j,selectedLocation:h})})]}),o.jsx(R,{show:v,onClose:()=>{n(!1),l(null),r({})},title:"Edit Site",initialData:m,onSubmit:N,fields:T,submitText:u?"Updating...":"Update Site",processing:u,formData:y,onFormChange:r})]})]})}export{ae as default};
