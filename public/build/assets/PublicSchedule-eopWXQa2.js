import{r,j as e,a as F}from"./app-ChRB4esy.js";import se from"./ResidentMap-honn9RZS.js";import{S as be}from"./react-select.esm-Dzky0Hoc.js";import{C as ne}from"./ClientPagination-BwyTZEKC.js";import fe from"./ScheduleHero-BAWSN_OB.js";import{C as A}from"./clock-PzuyC9Gi.js";import{M as P}from"./map-pin-BBuGaC-r.js";import{C as re}from"./calendar-CeanvXX1.js";import{c as je}from"./createLucideIcon-BiaWP0nn.js";import{C as oe,a as ve}from"./chevron-right-BVYfgs1R.js";import{X as Ne}from"./x-Dji0wrle.js";import"./mapbox-gl-CtZq5z7E.js";import"./index-DL0OwKpY.js";import"./iconBase-2FgA_EyQ.js";import"./index-CnyDuYXe.js";import"./index-DCEew1Wh.js";import"./sanfrance-BkZK3VBS.js";import"./arrow-left-bvzN5q-b.js";import"./truck-Cs-DH38r.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],Se=je("calendar-days",we),N=["January","February","March","April","May","June","July","August","September","October","November","December"],De=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ie=(p,u)=>new Date(p,u+1,0).getDate(),Me=(p,u)=>new Date(p,u,1).getDay(),Ve=()=>{const[p,u]=r.useState(!1),[m,le]=r.useState(null),[L,B]=r.useState(!1),[i,E]=r.useState(null),[z,ce]=r.useState([]),[O,w]=r.useState([]),[U,H]=r.useState([]),[J,W]=r.useState(!0),[S,Y]=r.useState(!1),[de,X]=r.useState(!0),[y]=r.useState(new Date),[d,K]=r.useState(y.getMonth()),[g,V]=r.useState(y.getFullYear()),[x,D]=r.useState("today"),[ke,_e]=r.useState(!1),[M,f]=r.useState(1),[k]=r.useState(5);r.useEffect(()=>{(async()=>{try{W(!0);const a=await F.get("/getBarangay");if(a.data.success){const s=a.data.barangay_data.map(l=>({value:l.id,label:l.baranggay_name}));ce(s)}}catch(a){console.error("Error fetching barangays:",a)}finally{W(!1)}})()},[]),r.useEffect(()=>{(async()=>{try{X(!0);const a=await F.get("/getBarangay/schedule/today/all");a.data.success&&H(a.data.schedules||[])}catch(a){console.error("Error fetching today's schedules:",a),H([])}finally{X(!1)}})()},[]),r.useEffect(()=>{(async()=>{if(!i){w([]);return}try{Y(!0);const a=await F.get(`/getBarangay/schedule/${i.value}`);a.data.success&&(w(a.data.barangaySchedule||[]),f(1))}catch(a){console.error("Error fetching schedules:",a),w([])}finally{Y(!1)}})()},[i]),r.useEffect(()=>{f(1)},[x]),r.useEffect(()=>()=>{document.body.style.overflow="auto"},[]);const _=t=>{const a=new Date,n=new Date(t.collection_date),s=new Date().toDateString(),l=new Date(t.collection_date).toDateString();if(s!==l)return n<a?t.status==="completed"?"completed":"failed":"upcoming";if(t.collection_time){const[o,b]=t.collection_time.split(":");n.setHours(parseInt(o),parseInt(b),0)}else n.setHours(8,0,0);const c=new Date(n);return c.setHours(c.getHours()+4),a<n?"upcoming":a>=n&&a<=c?t.status==="in_progress"?"in_progress":"active":a>c&&t.status==="completed"?"completed":a>c&&t.status!=="completed"?"failed":"upcoming"},q=t=>{const a=_(t);return a==="active"||a==="in_progress"},C=t=>{if(le(t),!i&&t.barangay_id){const a=z.find(n=>n.value===t.barangay_id);a&&E(a)}u(!0),B(!0),document.body.style.overflow="hidden"},G=()=>{u(!1),B(!1),document.body.style.overflow="auto"},Q=t=>{const a=new Date(t),n=N[a.getMonth()],s=a.getDate(),l=a.toLocaleDateString("en-US",{weekday:"long"});return`${n} ${s} - ${l}`},Z=t=>{if(!t)return"8:00 AM";try{if(typeof t=="string"&&t.includes(":")){const[a,n]=t.split(":"),s=parseInt(a),l=s>=12?"PM":"AM";return`${s%12||12}:${n} ${l}`}}catch(a){console.error("Error formatting time:",a)}return"8:00 AM"},ee=t=>{const a=new Date,n=new Date(t.collection_date);if(t.collection_time){const[v,h]=t.collection_time.split(":");n.setHours(parseInt(v),parseInt(h),0)}else n.setHours(8,0,0);const s=n.getTime()-a.getTime();if(s<=0)return{days:0,hours:0,minutes:0,seconds:0,isActive:!0};const l=Math.floor(s/(1e3*60*60*24)),c=Math.floor(s%(1e3*60*60*24)/(1e3*60*60)),o=Math.floor(s%(1e3*60*60)/(1e3*60)),b=Math.floor(s%(1e3*60)/1e3);return{days:l,hours:c,minutes:o,seconds:b,isActive:!1}},T=()=>O.length?O.map(t=>{var c;const a=_(t),n=Q(t.collection_date),s=Z(t.collection_time),l=ee(t);return{id:t.id,formattedDate:n,time:s,status:a,timeRemaining:l,collection_date:t.collection_date,collection_time:t.collection_time,barangay_name:((c=t.barangay)==null?void 0:c.baranggay_name)||"Unknown",barangay_id:t.barangay_id,originalData:t}}):[],me=()=>U.length?U.map(t=>{var c;const a=_(t),n=Q(t.collection_date),s=Z(t.collection_time),l=ee(t);return{id:t.id,formattedDate:n,time:s,status:a,timeRemaining:l,collection_date:t.collection_date,collection_time:t.collection_time,barangay_name:((c=t.barangay)==null?void 0:c.baranggay_name)||"Unknown",barangay_id:t.barangay_id,originalData:t}}):[],j=t=>{switch(t){case"active":return"bg-green-500/20 text-green-700 border-green-400/30";case"in_progress":return"bg-yellow-500/20 text-yellow-700 border-yellow-400/30";case"completed":return"bg-blue-500/20 text-blue-700 border-blue-400/30";case"failed":return"bg-red-500/20 text-red-700 border-red-400/30";case"upcoming":return"bg-purple-500/20 text-purple-700 border-purple-400/30";default:return"bg-gray-500/20 text-gray-700 border-gray-400/30"}},te=t=>{const a=(M-1)*k;return t.slice(a,a+k)},ae=t=>Math.ceil(t.length/k),I=()=>{if(!i)return me().filter(a=>q(a.originalData));const t=new Date().toDateString();return T().filter(a=>new Date(a.collection_date).toDateString()===t&&q(a.originalData))},R=()=>{if(!i)return[];const t=new Date,a=new Date;return a.setDate(t.getDate()+7),T().filter(n=>{const s=new Date(n.collection_date);return s>=t&&s<=a})},$=()=>i?T().filter(n=>{const s=new Date(n.collection_date);return s.getMonth()===d&&s.getFullYear()===g}).map(n=>{const s=new Date(n.collection_date);return{...n,date:s.getDate(),dayName:s.toLocaleDateString("en-US",{weekday:"long"})}}):[],ge=()=>{K(t=>t===0?11:t-1),d===0&&V(t=>t-1)},xe=()=>{K(t=>t===11?0:t+1),d===11&&V(t=>t+1)},he=()=>{const t=ie(g,d),a=Me(g,d),n=$(),s=[];for(let o=0;o<a;o++)s.push(e.jsx("div",{className:"min-h-20 bg-gray-100/30 rounded-lg opacity-50",children:e.jsx("div",{className:"text-sm text-gray-400 p-2",children:ie(d===0?g-1:g,d===0?11:d-1)-a+o+1})},`empty-${o}`));for(let o=1;o<=t;o++){const b=n.filter(h=>h.date===o),v=o===y.getDate()&&d===y.getMonth()&&g===y.getFullYear();s.push(e.jsxs("div",{className:`min-h-20 p-2 rounded-lg border transition-all ${v?"bg-green-500/20 border-green-500":"bg-white border-gray-200 hover:border-green-300"}`,children:[e.jsx("div",{className:`text-sm font-semibold mb-1 ${v?"text-green-700":"text-gray-900"}`,children:o}),e.jsx("div",{className:"space-y-1",children:b.map((h,pe)=>e.jsx("div",{children:e.jsx("span",{className:`text-xs px-2 py-1 rounded border block truncate ${j(h.status)}`,children:h.status.charAt(0).toUpperCase()+h.status.slice(1)})},pe))})]},o))}const c=42-(a+t);for(let o=0;o<c;o++)s.push(e.jsx("div",{className:"min-h-20 bg-gray-100/30 rounded-lg opacity-50",children:e.jsx("div",{className:"text-sm text-gray-400 p-2",children:o+1})},`next-${o}`));return s},ue={control:t=>({...t,height:"52px",border:"2px solid #e5e7eb",borderRadius:"12px",fontSize:"1rem",boxShadow:"0 2px 10px -3px rgba(0, 0, 0, 0.1)","&:hover":{borderColor:"#10b981"}}),option:(t,a)=>({...t,backgroundColor:a.isSelected?"#10b981":a.isFocused?"#ecfdf5":"white",color:a.isSelected?"white":"#374151"})},[Ce,ye]=r.useState(new Date);return r.useEffect(()=>{const t=setInterval(()=>{ye(new Date)},1e3);return()=>clearInterval(t)},[]),J?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-green-50 to-blue-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading barangays..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-green-50 to-blue-50",children:[e.jsx(fe,{}),e.jsxs("main",{className:"container mx-auto px-4 py-12 -mt-12",children:[e.jsx("div",{className:"max-w-2xl mx-auto mb-12",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Find Collection Schedules"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Select your barangay to view collection schedules"})]}),e.jsx(be,{value:i,onChange:E,options:z,placeholder:"Choose your barangay...",styles:ue,isSearchable:!0,isClearable:!0,isLoading:J})]})}),e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-1",children:[e.jsx("button",{onClick:()=>D("today"),className:`px-6 py-3 rounded-lg font-semibold transition-all ${x==="today"?"bg-green-500 text-white shadow-lg":"text-gray-700 hover:text-green-600"}`,children:"Today"}),i&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>D("week"),className:`px-6 py-3 rounded-lg font-semibold transition-all ${x==="week"?"bg-green-500 text-white shadow-lg":"text-gray-700 hover:text-green-600"}`,children:"Week"}),e.jsx("button",{onClick:()=>D("month"),className:`px-6 py-3 rounded-lg font-semibold transition-all ${x==="month"?"bg-green-500 text-white shadow-lg":"text-gray-700 hover:text-green-600"}`,children:"Month"})]})]})}),x==="today"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:i?`Today's Active Collections - ${i.label}`:"Today's Active Collections - All Barangays"}),e.jsx("p",{className:"text-gray-600",children:y.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsx("div",{className:"p-6",children:de||i&&S?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading today's schedules..."})]}):I().length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:te(I()).map((t,a)=>e.jsx("div",{className:"border border-gray-200 rounded-xl p-6 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.formattedDate}),!i&&e.jsx("span",{className:"bg-blue-100 text-blue-700 text-sm px-3 py-1 rounded-full font-medium",children:t.barangay_name})]}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx(A,{className:"h-4 w-4"}),"Start - ",t.time]}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full mt-2 inline-block ${j(t.status)}`,children:t.status==="in_progress"?"In Progress":"Active"})]}),e.jsx("div",{className:"text-right",children:e.jsxs("button",{onClick:()=>C(t),className:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors shadow-md hover:shadow-lg flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Track Live"]})})]})},a))}),e.jsx(ne,{currentPage:M,totalPages:ae(I()),onPageChange:f})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(re,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-600",children:"No active collections for today"}),e.jsx("p",{className:"text-gray-500 mt-2",children:i?"Check back later for updates":"There are no scheduled collections for today across all barangays"})]})})]}),i&&x==="week"&&!S&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800",children:["This Week's Collections - ",i.label]}),e.jsx("p",{className:"text-gray-600",children:"Schedules for the next 7 days"})]}),e.jsx("div",{className:"p-6",children:R().length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:te(R()).map((t,a)=>e.jsx("div",{className:"border border-gray-200 rounded-xl p-6 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.formattedDate}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx(A,{className:"h-4 w-4"}),"Start - ",t.time]}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full mt-2 inline-block ${j(t.status)}`,children:t.status==="in_progress"?"In Progress":t.status==="active"?"Active":t.status==="upcoming"?"Upcoming":t.status.charAt(0).toUpperCase()+t.status.slice(1)})]}),e.jsx("div",{className:"text-right",children:t.status==="active"||t.status==="in_progress"?e.jsxs("button",{onClick:()=>C(t),className:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors shadow-md hover:shadow-lg flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Track Live"]}):e.jsxs("div",{className:"text-gray-500 text-sm",children:[t.timeRemaining.days>0&&`${t.timeRemaining.days}d `,t.timeRemaining.hours,"h ",t.timeRemaining.minutes,"m"]})})]})},a))}),e.jsx(ne,{currentPage:M,totalPages:ae(R()),onPageChange:f})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Se,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-600",children:"No collections scheduled this week"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Check the month view for upcoming schedules"})]})})]}),i&&x==="month"&&!S&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800",children:["Monthly Schedule - ",i.label]}),e.jsxs("p",{className:"text-gray-600",children:[N[d]," ",g]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:ge,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(oe,{className:"h-5 w-5"})}),e.jsx("button",{onClick:xe,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(ve,{className:"h-5 w-5"})})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-4",children:De.map(t=>e.jsx("div",{className:"text-center text-sm font-semibold text-gray-600 py-2",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:he()}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:["Collection Schedule for ",N[d]," ",g]}),$().length>0?e.jsx("div",{className:"space-y-4",children:$().map((t,a)=>e.jsx("div",{className:"border border-gray-200 rounded-xl p-6 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.formattedDate}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx(A,{className:"h-4 w-4"}),"Start - ",t.time]}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full mt-2 inline-block ${j(t.status)}`,children:t.status==="in_progress"?"In Progress":t.status==="active"?"Active":t.status==="upcoming"?"Upcoming":t.status.charAt(0).toUpperCase()+t.status.slice(1)})]}),e.jsx("div",{className:"text-right",children:t.status==="active"||t.status==="in_progress"?e.jsxs("button",{onClick:()=>C(t),className:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors shadow-md hover:shadow-lg flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Track Live"]}):e.jsxs("div",{className:"text-gray-500 text-sm",children:[t.timeRemaining.days>0&&`${t.timeRemaining.days}d `,t.timeRemaining.hours,"h ",t.timeRemaining.minutes,"m"]})})]})},a))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(re,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-600",children:["No collections scheduled for ",N[d]," ",g]}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Try navigating to other months"})]})]})]})]}),p&&m&&m.barangay_id&&e.jsx("div",{id:"resident-map-section",className:`${L?"fixed inset-0 z-[9999] bg-white":"mt-12"}`,children:L?e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsx("div",{className:"bg-black px-4 py-3 sm:px-6 sm:py-4 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:G,className:"flex items-center gap-2 text-white hover:bg-white/20 px-3 py-2 rounded-lg transition-colors",children:[e.jsx(oe,{className:"h-5 w-5"}),e.jsx("span",{className:"font-semibold",children:"Back"})]}),e.jsxs("div",{className:"flex-1 text-center px-4",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-white truncate",children:m.barangay_name}),e.jsxs("p",{className:"text-xs sm:text-sm text-white/90 hidden sm:block",children:[m.formattedDate," at ",m.time]})]}),e.jsx("div",{className:"w-20"})," "]})}),e.jsx("div",{className:"flex-1 relative overflow-hidden",children:e.jsx(se,{mapboxKey:"pk.eyJ1IjoibWFraXNlbnBhaSIsImEiOiJjbTkza3F0NzMwb21tMmxwdzRzYWFncTRoIn0.tRpH1NPUfzt9cvv4IOpxJA",barangayId:m.barangay_id,scheduleId:m.id,isFullscreen:!0})})]}):e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Live Collection Map"}),e.jsxs("p",{className:"text-gray-600",children:["Real-time tracking for ",m.barangay_name," - ",m.formattedDate]})]}),e.jsx("button",{onClick:G,className:"text-gray-500 hover:text-gray-700 p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(Ne,{className:"h-5 w-5"})})]})}),e.jsx("div",{className:"p-6",children:e.jsx(se,{mapboxKey:"pk.eyJ1IjoibWFraXNlbnBhaSIsImEiOiJjbTkza3F0NzMwb21tMmxwdzRzYWFncTRoIn0.tRpH1NPUfzt9cvv4IOpxJA",barangayId:m.barangay_id,scheduleId:m.id,isFullscreen:!1})})]})})]})]})]})};export{Ve as default};
