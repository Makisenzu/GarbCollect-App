import{r as m,j as e}from"./app-CzgwYLWh.js";const B=({show:j,onClose:h,schedule:a})=>{var u;const[i,p]=m.useState(null);if(!j)return null;const d=(a==null?void 0:a.reports)&&a.reports.length>0,y=d?a.reports.filter(s=>s.report_picture).flatMap(s=>{if(Array.isArray(s.report_picture))return s.report_picture;if(typeof s.report_picture=="string")try{const l=JSON.parse(s.report_picture);return Array.isArray(l)?l:[s.report_picture]}catch{return[s.report_picture]}return[]}):[],x=[...new Set(y)];return e.jsxs(e.Fragment,{children:[i&&e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 z-[60] flex items-center justify-center p-4",onClick:()=>p(null),children:[e.jsx("button",{onClick:()=>p(null),className:"absolute top-4 right-4 text-white hover:text-gray-300 z-10",children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("img",{src:i,alt:"Full size preview",className:"max-w-full max-h-full object-contain",onClick:s=>s.stopPropagation()})]}),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Collection Report"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-0.5",children:[(u=a==null?void 0:a.barangay)==null?void 0:u.baranggay_name," - ",new Date(a==null?void 0:a.collection_date).toLocaleDateString()]})]}),e.jsx("button",{onClick:h,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:d?e.jsxs("div",{className:"space-y-6",children:[x.length>0?e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:["Collection Photos (",x.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:x.map((s,l)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:`/storage/${s}`,alt:`Collection photo ${l+1}`,className:"w-full h-48 object-cover rounded-lg border border-gray-200 cursor-pointer transition-transform hover:scale-105",onClick:()=>p(`/storage/${s}`),onError:g=>{g.target.onerror=null,g.target.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100"%3E%3Crect fill="%23f3f4f6" width="100" height="100"/%3E%3Ctext x="50%25" y="50%25" dominant-baseline="middle" text-anchor="middle" font-family="sans-serif" font-size="14" fill="%239ca3af"%3ENo Image%3C/text%3E%3C/svg%3E'}}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})})}),e.jsxs("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded",children:["Photo ",l+1]})]},l))})]}):e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("svg",{className:"mx-auto h-10 w-10 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"No photos submitted"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Waste Collection Summary"}),e.jsx("div",{className:"bg-gray-50 rounded-lg border border-gray-200 overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-900 uppercase",children:"Garbage Type"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-900 uppercase",children:"Kilograms"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[a.reports.map((s,l)=>{var g;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:((g=s.garbage)==null?void 0:g.garbage_type)||"Unknown"}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-900 text-right font-medium",children:[parseFloat(s.kilograms).toFixed(2)," kg"]})]},l)}),e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-gray-900",children:"Total"}),e.jsxs("td",{className:"px-4 py-3 text-sm font-bold text-gray-900 text-right",children:[a.reports.reduce((s,l)=>s+parseFloat(l.kilograms||0),0).toFixed(2)," kg"]})]})]})]})})]}),a.reports.some(s=>s.additional_notes)&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Additional Notes"}),e.jsx("div",{className:"space-y-2",children:a.reports.filter(s=>s.additional_notes).map((s,l)=>e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-gray-700",children:s.additional_notes})},l))})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No Report Submitted"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This collection has not been reported yet."})]})}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end",children:e.jsx("button",{onClick:h,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Close"})})]})})]})},W=({drivers:j,barangays:h,schedules:a})=>{const[i,p]=m.useState(""),[d,y]=m.useState("today"),[x,u]=m.useState([]),[s,l]=m.useState(!1),[g,v]=m.useState(!1),[k,C]=m.useState(null),D=t=>{C(t),v(!0)};m.useEffect(()=>{if(!i){u([]);return}l(!0);let t=a.filter(n=>n.barangay_id==i);const r=new Date,o=new Date(r.getFullYear(),r.getMonth(),r.getDate());switch(d){case"today":t=t.filter(b=>{const c=new Date(b.collection_date);return new Date(c.getFullYear(),c.getMonth(),c.getDate()).getTime()===o.getTime()});break;case"week":const n=new Date(o);n.setDate(o.getDate()-o.getDay()),n.setHours(0,0,0,0);const f=new Date(n);f.setDate(n.getDate()+6),f.setHours(23,59,59,999),t=t.filter(b=>{const c=new Date(b.collection_date);return c>=n&&c<=f});break;case"month":const N=new Date(r.getFullYear(),r.getMonth(),1);N.setHours(0,0,0,0);const w=new Date(r.getFullYear(),r.getMonth()+1,0);w.setHours(23,59,59,999),t=t.filter(b=>{const c=new Date(b.collection_date);return c>=N&&c<=w});break}u(t),l(!1)},[i,d,a]);const S=t=>{if(!t)return"N/A";try{return new Date(t).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})}catch{return"Invalid Date"}},M=t=>{if(!t)return"N/A";try{const[r,o]=t.split(":").map(Number),n=r>=12?"PM":"AM";return`${r%12||12}:${o.toString().padStart(2,"0")} ${n}`}catch{return t}},L=t=>{const r=a.find(n=>n.driver_id==t);if(r&&r.driver&&r.driver.user)return`${r.driver.user.name} ${r.driver.user.lastname}`;const o=j.find(n=>n.id==t);return o&&o.user?`${o.user.name} ${o.user.lastname}`:"Unknown Driver"},_=t=>{const o={progress:{color:"bg-yellow-50 text-yellow-700 border-yellow-200",label:"Pending"},active:{color:"bg-blue-50 text-blue-700 border-blue-200",label:"Active"},inactive:{color:"bg-gray-50 text-gray-700 border-gray-200",label:"Inactive"},completed:{color:"bg-green-50 text-green-700 border-green-200",label:"Completed"},failed:{color:"bg-red-50 text-red-700 border-red-200",label:"Failed"}}[t]||{color:"bg-gray-50 text-gray-700 border-gray-200",label:t};return e.jsx("span",{className:`inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium border ${o.color}`,children:o.label})},$=t=>{const r=a.find(n=>n.barangay_id==t);if(r&&r.barangay)return r.barangay.baranggay_name;const o=h.find(n=>n.id==t);return o?o.baranggay_name:"Unknown Barangay"};return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsx(B,{show:g,onClose:()=>v(!1),schedule:k}),e.jsx("div",{className:"px-6 py-5 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"Collection Schedules"}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"View and manage collection schedules by barangay"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("div",{className:"w-full sm:w-64",children:e.jsxs("select",{id:"barangay",value:i,onChange:t=>p(t.target.value),className:"w-full text-sm rounded-md border-gray-300 shadow-sm focus:border-gray-900 focus:ring-gray-900",children:[e.jsx("option",{value:"",children:"Select barangay"}),h.map(t=>e.jsx("option",{value:t.id,children:t.baranggay_name},t.id))]})}),e.jsxs("div",{className:"inline-flex rounded-md shadow-sm",role:"group",children:[e.jsx("button",{type:"button",onClick:()=>y("today"),className:`px-4 py-2 text-xs font-medium border ${d==="today"?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"} rounded-l-md transition-colors`,children:"Today"}),e.jsx("button",{type:"button",onClick:()=>y("week"),className:`px-4 py-2 text-xs font-medium border-t border-b ${d==="week"?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"} transition-colors`,children:"This Week"}),e.jsx("button",{type:"button",onClick:()=>y("month"),className:`px-4 py-2 text-xs font-medium border ${d==="month"?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"} rounded-r-md transition-colors`,children:"This Month"})]})]})]})}),e.jsx("div",{className:"p-6",children:i?s?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No schedules found"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["No collection schedules found for ",$(i)," in the selected time period"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider bg-gray-50",children:"Driver"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider bg-gray-50",children:"Collection Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider bg-gray-50",children:"Collection Time"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider bg-gray-50",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-semibold text-gray-900 uppercase tracking-wider bg-gray-50",children:"Notes"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-semibold text-gray-900 uppercase tracking-wider bg-gray-50",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map(t=>{var r;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:L(t.driver_id)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["License: ",((r=t.driver)==null?void 0:r.license_number)||"N/A"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:S(t.collection_date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:M(t.collection_time)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:_(t.status)}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 max-w-xs",children:e.jsx("div",{className:"truncate",title:t.notes,children:t.notes||"—"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.status==="completed"?e.jsxs("button",{onClick:()=>D(t),className:"inline-flex items-center px-3 py-1.5 text-xs font-medium text-blue-700 bg-blue-50 border border-blue-200 rounded-md hover:bg-blue-100 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"View Report"]}):e.jsx("span",{className:"text-xs text-gray-400",children:"—"})})]},t.id)})})]})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 flex justify-between items-center text-sm text-gray-500",children:[e.jsxs("div",{children:["Showing ",e.jsx("span",{className:"font-medium text-gray-900",children:x.length})," schedule",x.length!==1?"s":""]}),e.jsxs("div",{children:["Last updated: ",new Date().toLocaleTimeString()]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No barangay selected"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Select a barangay above to view collection schedules"})]})})]})};export{W as default};
