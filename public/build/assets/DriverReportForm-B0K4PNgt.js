import{J as T,r as o,a as m,S as u,j as e}from"./app-DmC1MigL.js";const G=({scheduleId:d,token:g})=>{const{props:A}=T(),[r,c]=o.useState({garbage_id:"",report_pictures:[],kilograms:"",additional_notes:""}),[y,v]=o.useState([]),[j,N]=o.useState(!0),[x,b]=o.useState(!1),[w,k]=o.useState(!1),[n,p]=o.useState([]);o.useEffect(()=>{_(),S()},[d,g]);const _=async()=>{try{(await m.post("/validate-report-token",{schedule_id:d,token:g})).data.valid?k(!0):(alert("Invalid or expired access token. Please complete your route first."),u.visit("/dashboard"))}catch(t){console.error("Token validation error:",t),alert("Error validating access. Please try again."),u.visit("/dashboard")}finally{N(!1)}},S=async()=>{try{const t=await m.get("/garbage-types");v(t.data.data||[])}catch(t){console.error("Error fetching garbage types:",t)}},h=t=>{const{name:s,value:a}=t.target;c(i=>({...i,[s]:a}))},C=t=>{const s=Array.from(t.target.files);if(s.length===0)return;const a=[],i=[];for(const l of s){if(!l.type.startsWith("image/")){alert(`${l.name} is not an image file`);continue}if(l.size>5*1024*1024){alert(`${l.name} is larger than 5MB`);continue}a.push(l);const f=new FileReader;f.onload=E=>{i.push(E.target.result),i.length===a.length&&p(R=>[...R,...i])},f.readAsDataURL(l)}a.length>0&&c(l=>({...l,report_pictures:[...l.report_pictures,...a]}))},P=t=>{c(s=>({...s,report_pictures:s.report_pictures.filter((a,i)=>i!==t)})),p(s=>s.filter((a,i)=>i!==t))},D=async t=>{if(t.preventDefault(),!r.garbage_id||!r.kilograms){alert("Please fill in all required fields");return}if(r.kilograms<0){alert("Weight cannot be negative");return}b(!0);try{const s=new FormData;s.append("schedule_id",d),s.append("garbage_id",r.garbage_id),s.append("kilograms",r.kilograms),s.append("additional_notes",r.additional_notes||""),r.report_pictures.length>0&&r.report_pictures.forEach((i,l)=>{s.append(`report_pictures[${l}]`,i)});const a=await m.post("/submit-report",s,{headers:{"Content-Type":"multipart/form-data"}});a.data.success?(alert("Report submitted successfully!"),await m.post("/invalidate-report-token",{schedule_id:d,token:g}),u.visit("/dashboard")):alert("Failed to submit report: "+(a.data.message||"Unknown error"))}catch(s){console.error("Error submitting report:",s),alert("Error submitting report. Please try again.")}finally{b(!1)}};return j?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Validating access..."})]})}):w?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-green-500 text-6xl mb-4",children:"✅"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Route Completed!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Please submit your collection report"})]}),e.jsxs("form",{onSubmit:D,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Garbage Type *"}),e.jsxs("select",{name:"garbage_id",value:r.garbage_id,onChange:h,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Garbage Type"}),y.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Weight Collected (Kilograms) *"}),e.jsx("input",{type:"number",name:"kilograms",value:r.kilograms,onChange:h,min:"0",step:"0.1",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter weight in kilograms"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Collection Photos (Multiple)"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center",children:[e.jsx("input",{id:"photo-upload",type:"file",accept:"image/*",multiple:!0,onChange:C,className:"hidden"}),e.jsxs("label",{htmlFor:"photo-upload",className:"cursor-pointer inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Photos"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Select multiple images (max 5MB each)"}),n.length>0&&e.jsxs("p",{className:"text-sm text-green-600 mt-1 font-medium",children:[n.length," photo",n.length!==1?"s":""," selected"]})]}),n.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700",children:["Selected Photos (",n.length,")"]}),e.jsx("button",{type:"button",onClick:()=>{c(t=>({...t,report_pictures:[]})),p([])},className:"text-xs text-red-600 hover:text-red-700 font-medium",children:"Remove All"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:n.map((t,s)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t,alt:`Preview ${s+1}`,className:"w-full h-32 object-cover rounded-md border-2 border-gray-200"}),e.jsx("button",{type:"button",onClick:()=>P(s),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full w-7 h-7 flex items-center justify-center hover:bg-red-600 shadow-md",children:"×"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs py-1 text-center rounded-b-md",children:["Photo ",s+1]})]},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),e.jsx("textarea",{name:"additional_notes",value:r.additional_notes,onChange:h,rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Any additional information about the collection..."})]}),e.jsx("button",{type:"submit",disabled:x,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:x?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Submitting..."]}):"Submit Report"})]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"Invalid or expired access token."}),e.jsx("button",{onClick:()=>u.visit("/dashboard"),className:"mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700",children:"Return to Dashboard"})]})})};export{G as default};
