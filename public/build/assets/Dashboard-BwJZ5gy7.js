import{J as f,r as h,j as e,Q as N}from"./app-CkN8LLiX.js";import{A as w}from"./AuthenticatedLayout-B2cjiLyh.js";import y from"./StatCard-CmFzunXP.js";import T from"./Schedule-C5_hxtbg.js";import S from"./TaskMap-BIXDBmzS.js";import C from"./CalendarWidget-CEy9aA2Q.js";import"./Dropdown-DAT3z_ZX.js";import"./app-logo-5yzjSYqx.js";import"./transition-CvOvmka_.js";import"./index-B27tiufo.js";import"./iconBase-DZ0bFjUZ.js";import"./index-ru_g6XJB.js";import"./index-lSSCCM9N.js";import"./imageHelpers-BzNwYwgf.js";import"./CompletionReportModal-DHDckEpZ.js";import"./map-pin-DdKoMWpD.js";import"./createLucideIcon-DrF_9Zz1.js";import"./circle-alert-CF4cYFuC.js";import"./calendar-D8KvMPpb.js";import"./clock-Dg9P-qt8.js";import"./circle-check-big-DGjFnrGG.js";import"./eye-BPT4uml5.js";import"./x-DXeCMWsL.js";import"./mapbox-gl-BgEYKG4G.js";import"./index-B9iM_rng.js";import"./useTaskMap-B6y7jQBM.js";import"./useLocationTracking-CZ6iGJ0o.js";import"./useMapboxSetup-GDX88QdV.js";import"./useMapLayers-BdL2kQ2e.js";import"./index-7n7ahmYM.js";import"./can-3MqaZyCZ.js";import"./useRouteCalculations-CN3qHdIC.js";import"./useSiteManagement-Tq2mEM8r.js";/* empty css                  */import"./chevron-right-CWJVH3gc.js";function L(){var a,n,c;const{props:l}=f(),[p,g]=h.useState(l.schedules||[]),[r,s]=h.useState(null);return h.useEffect(()=>{var d,m,u;const i=(u=(m=(d=l.auth)==null?void 0:d.user)==null?void 0:m.driver)==null?void 0:u.id;if(!i){console.log("No driver ID found");return}if(!window.Echo){console.log("Echo not available");return}try{window.Echo.private(`driver.${i}`).listen(".new.schedule",o=>{g(x=>[o.schedule,...x]),s({type:"success",title:"New Schedule Assigned",message:o.message,schedule:o.schedule}),setTimeout(()=>{s(null)},5e3)})}catch(o){console.error("Error setting up Echo listener:",o)}return()=>{window.Echo&&(window.Echo.leave(`driver.${i}`),console.log("Left channel:",`driver.${i}`))}},[(c=(n=(a=l.auth)==null?void 0:a.user)==null?void 0:n.driver)==null?void 0:c.id]),{schedules:p,notification:r,setNotification:s}}function de(){const{stats:l,hasDriver:p,auth:g}=f().props,{schedules:r,notification:s,setNotification:a}=L(),[n,c]=h.useState(null),[i,d]=h.useState(!1),m=h.useMemo(()=>!p||r.length===0?l:[{title:"Total Schedules",value:r.length,description:"All your schedules"},{title:"Completed",value:r.filter(t=>t.status==="completed").length,description:"Successful collections"},{title:"Pending",value:r.filter(t=>t.status==="active").length,description:"Upcoming schedules"},{title:"Failed",value:r.filter(t=>t.status==="failed").length,description:"Failed collections"}],[r,p,l]),u=t=>{c(t),d(!0)},o=t=>{console.log("Task completed with data:",t),c(null),d(!1),a({type:"success",title:"Task Completed",message:"Collection task has been completed successfully."})},x=()=>{c(null),d(!1),a({type:"info",title:"Task Cancelled",message:"The collection task has been cancelled."})},v=t=>{console.log("Location selected:",t)},j=t=>{console.log("Edit site:",t)},b=t=>{console.log("Delete site:",t)};return e.jsxs(w,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:i?"Site Routes":"Driver Dashboard"}),children:[e.jsx(N,{title:i?"Active Task":"Driver Dashboard"}),s&&e.jsx("div",{className:"fixed top-4 right-4 z-50 max-w-sm w-full animate-in slide-in-from-right duration-300",children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ${s.type==="success"?"bg-green-100":s.type==="error"?"bg-red-100":"bg-blue-100"}`,children:[s.type==="success"&&e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),s.type==="error"&&e.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),s.type==="info"&&e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:s.title}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:s.message})]}),e.jsx("button",{onClick:()=>a(null),className:"flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})})}),i&&n?e.jsx("div",{className:"fixed inset-0 z-40 lg:left-64 lg:top-16 top-16 bg-gray-50",children:e.jsx(S,{mapboxKey:"pk.eyJ1IjoibWFraXNlbnBhaSIsImEiOiJjbTkza3F0NzMwb21tMmxwdzRzYWFncTRoIn0.tRpH1NPUfzt9cvv4IOpxJA",onLocationSelect:v,refreshTrigger:n.id,onEditSite:j,onDeleteSite:b,scheduleId:n.id,onTaskComplete:o,onTaskCancel:x})}):e.jsx("div",{className:"py-8 bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:m&&Array.isArray(m)&&m.map((t,k)=>e.jsx(y,{title:t.title,value:t.value,description:t.description},k))})}),p?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(C,{schedules:r})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(T,{drivers:[],barangays:[],schedules:r,onStartTask:u,mapboxKey:"pk.eyJ1IjoibWFraXNlbnBhaSIsImEiOiJjbTkza3F0NzMwb21tMmxwdzRzYWFncTRoIn0.tRpH1NPUfzt9cvv4IOpxJA"})})]}):e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-10 h-10 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Complete Your Driver Profile"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"To view and manage schedules, please complete your driver profile first."}),e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-lg font-medium transition-colors",children:"Complete Profile"})]})})]})})]})}export{de as default};
