import{r as n,j as e,a as Y}from"./app-B6op6jpD.js";import X from"./ResidentMap-d5O9WHnj.js";import{S as he}from"./react-select.esm-Dhv2zySi.js";import{C as K}from"./ClientPagination-CTs22fJw.js";import ge from"./ScheduleHero-CqayBDAL.js";import{C as T}from"./clock-COJcbuS6.js";import{M as R}from"./map-pin-onofBcC4.js";import{C as V}from"./calendar-Cum-rvGI.js";import{c as ue}from"./createLucideIcon-DobrXYNv.js";import{C as q,a as pe}from"./chevron-right-CvUc8T8O.js";import{X as ye}from"./x-B7mXYhTC.js";import{T as be}from"./truck-DsNV0Phz.js";import"./mapbox-gl-CRhpymhd.js";import"./index-D9ajuYI7.js";import"./iconBase-f9qwwLH2.js";import"./index-CnyDuYXe.js";import"./index-Cwy-ZRjp.js";import"./sanfrance-BkZK3VBS.js";import"./arrow-left-BtvK6i4U.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],je=ue("calendar-days",fe),N=["January","February","March","April","May","June","July","August","September","October","November","December"],ve=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],G=(p,h)=>new Date(p,h+1,0).getDate(),Ne=(p,h)=>new Date(p,h,1).getDay(),We=()=>{const[p,h]=n.useState(!1),[g,Q]=n.useState(null),[F,$]=n.useState(!1),[l,Z]=n.useState(null),[ee,te]=n.useState([]),[A,w]=n.useState([]),[P,L]=n.useState(!0),[z,B]=n.useState(!1),[u]=n.useState(new Date),[c,E]=n.useState(u.getMonth()),[m,O]=n.useState(u.getFullYear()),[y,se]=n.useState("today"),[we,Se]=n.useState(!1),[S,f]=n.useState(1),[D]=n.useState(5);n.useEffect(()=>{(async()=>{try{L(!0);const s=await Y.get("/getBarangay");if(s.data.success){const a=s.data.barangay_data.map(i=>({value:i.id,label:i.baranggay_name}));te(a)}}catch(s){console.error("Error fetching barangays:",s)}finally{L(!1)}})()},[]),n.useEffect(()=>{(async()=>{if(!l){w([]);return}try{B(!0);const s=await Y.get(`/getBarangay/schedule/${l.value}`);s.data.success&&(w(s.data.barangaySchedule||[]),f(1))}catch(s){console.error("Error fetching schedules:",s),w([])}finally{B(!1)}})()},[l]),n.useEffect(()=>{f(1)},[y]),n.useEffect(()=>()=>{document.body.style.overflow="auto"},[]);const H=t=>{const s=new Date,r=new Date(t.collection_date),a=new Date().toDateString(),i=new Date(t.collection_date).toDateString();if(a!==i)return r<s?t.status==="completed"?"completed":"failed":"upcoming";if(t.collection_time){const[o,b]=t.collection_time.split(":");r.setHours(parseInt(o),parseInt(b),0)}else r.setHours(8,0,0);const d=new Date(r);return d.setHours(d.getHours()+4),s<r?"upcoming":s>=r&&s<=d?t.status==="in_progress"?"in_progress":"active":s>d&&t.status==="completed"?"completed":s>d&&t.status!=="completed"?"failed":"upcoming"},ae=t=>{const s=H(t);return s==="active"||s==="in_progress"},M=t=>{Q(t),h(!0),$(!0),document.body.style.overflow="hidden"},U=()=>{h(!1),$(!1),document.body.style.overflow="auto"},re=t=>{const s=new Date(t),r=N[s.getMonth()],a=s.getDate(),i=s.toLocaleDateString("en-US",{weekday:"long"});return`${r} ${a} - ${i}`},ne=t=>{if(!t)return"8:00 AM";try{if(typeof t=="string"&&t.includes(":")){const[s,r]=t.split(":"),a=parseInt(s),i=a>=12?"PM":"AM";return`${a%12||12}:${r} ${i}`}}catch(s){console.error("Error formatting time:",s)}return"8:00 AM"},oe=t=>{const s=new Date,r=new Date(t.collection_date);if(t.collection_time){const[v,x]=t.collection_time.split(":");r.setHours(parseInt(v),parseInt(x),0)}else r.setHours(8,0,0);const a=r.getTime()-s.getTime();if(a<=0)return{days:0,hours:0,minutes:0,seconds:0,isActive:!0};const i=Math.floor(a/(1e3*60*60*24)),d=Math.floor(a%(1e3*60*60*24)/(1e3*60*60)),o=Math.floor(a%(1e3*60*60)/(1e3*60)),b=Math.floor(a%(1e3*60)/1e3);return{days:i,hours:d,minutes:o,seconds:b,isActive:!1}},k=()=>A.length?A.map(t=>{const s=H(t),r=re(t.collection_date),a=ne(t.collection_time),i=oe(t);return{id:t.id,formattedDate:r,time:a,status:s,timeRemaining:i,collection_date:t.collection_date,collection_time:t.collection_time,originalData:t}}):(console.log("No schedules available for transformation"),[]),j=t=>{switch(t){case"active":return"bg-green-500/20 text-green-700 border-green-400/30";case"in_progress":return"bg-yellow-500/20 text-yellow-700 border-yellow-400/30";case"completed":return"bg-blue-500/20 text-blue-700 border-blue-400/30";case"failed":return"bg-red-500/20 text-red-700 border-red-400/30";case"upcoming":return"bg-purple-500/20 text-purple-700 border-purple-400/30";default:return"bg-gray-500/20 text-gray-700 border-gray-400/30"}},J=t=>{const s=(S-1)*D;return t.slice(s,s+D)},W=t=>Math.ceil(t.length/D),C=()=>{if(!l)return[];const t=new Date().toDateString();return k().filter(s=>new Date(s.collection_date).toDateString()===t&&ae(s.originalData))},I=()=>{if(!l)return[];const t=new Date,s=new Date;return s.setDate(t.getDate()+7),k().filter(r=>{const a=new Date(r.collection_date);return a>=t&&a<=s})},_=()=>{if(!l)return console.log("No barangay selected"),[];const s=k().filter(r=>{const a=new Date(r.collection_date);return a.getMonth()===c&&a.getFullYear()===m}).map(r=>{const a=new Date(r.collection_date);return{...r,date:a.getDate(),dayName:a.toLocaleDateString("en-US",{weekday:"long"})}});return console.log("Month schedules:",s.length),s},le=()=>{E(t=>t===0?11:t-1),c===0&&O(t=>t-1)},ie=()=>{E(t=>t===11?0:t+1),c===11&&O(t=>t+1)},ce=()=>{const t=G(m,c),s=Ne(m,c),r=_(),a=[];for(let o=0;o<s;o++)a.push(e.jsx("div",{className:"min-h-20 bg-gray-100/30 rounded-lg opacity-50",children:e.jsx("div",{className:"text-sm text-gray-400 p-2",children:G(c===0?m-1:m,c===0?11:c-1)-s+o+1})},`empty-${o}`));for(let o=1;o<=t;o++){const b=r.filter(x=>x.date===o),v=o===u.getDate()&&c===u.getMonth()&&m===u.getFullYear();a.push(e.jsxs("div",{className:`min-h-20 p-2 rounded-lg border transition-all ${v?"bg-green-500/20 border-green-500":"bg-white border-gray-200 hover:border-green-300"}`,children:[e.jsx("div",{className:`text-sm font-semibold mb-1 ${v?"text-green-700":"text-gray-900"}`,children:o}),e.jsx("div",{className:"space-y-1",children:b.map((x,xe)=>e.jsx("div",{children:e.jsx("span",{className:`text-xs px-2 py-1 rounded border block truncate ${j(x.status)}`,children:x.status.charAt(0).toUpperCase()+x.status.slice(1)})},xe))})]},o))}const d=42-(s+t);for(let o=0;o<d;o++)a.push(e.jsx("div",{className:"min-h-20 bg-gray-100/30 rounded-lg opacity-50",children:e.jsx("div",{className:"text-sm text-gray-400 p-2",children:o+1})},`next-${o}`));return a},de={control:t=>({...t,height:"52px",border:"2px solid #e5e7eb",borderRadius:"12px",fontSize:"1rem",boxShadow:"0 2px 10px -3px rgba(0, 0, 0, 0.1)","&:hover":{borderColor:"#10b981"}}),option:(t,s)=>({...t,backgroundColor:s.isSelected?"#10b981":s.isFocused?"#ecfdf5":"white",color:s.isSelected?"white":"#374151"})},[De,me]=n.useState(new Date);return n.useEffect(()=>{const t=setInterval(()=>{me(new Date)},1e3);return()=>clearInterval(t)},[]),P?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-green-50 to-blue-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading barangays..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-green-50 to-blue-50",children:[e.jsx(ge,{}),e.jsxs("main",{className:"container mx-auto px-4 py-12 -mt-12",children:[e.jsx("div",{className:"max-w-2xl mx-auto mb-12",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Find Collection Schedules"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Select your barangay to view collection schedules"})]}),e.jsx(he,{value:l,onChange:Z,options:ee,placeholder:"Choose your barangay...",styles:de,isSearchable:!0,isClearable:!0,isLoading:P})]})}),l&&e.jsxs("div",{className:"max-w-6xl mx-auto",children:[z&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto"}),e.jsxs("p",{className:"mt-4 text-gray-600",children:["Loading active schedules for ",l.label,"..."]})]}),!z&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("div",{className:"bg-white rounded-xl shadow-md p-1",children:["today","week","month"].map(t=>e.jsx("button",{onClick:()=>se(t),className:`px-6 py-3 rounded-lg font-semibold transition-all ${y===t?"bg-green-500 text-white shadow-lg":"text-gray-700 hover:text-green-600"}`,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})}),y==="today"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Today's Active Collections"}),e.jsx("p",{className:"text-gray-600",children:u.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsx("div",{className:"p-6",children:C().length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:J(C()).map((t,s)=>e.jsx("div",{className:"border border-gray-200 rounded-xl p-6 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.formattedDate}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx(T,{className:"h-4 w-4"}),"Start - ",t.time]}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full mt-2 inline-block ${j(t.status)}`,children:t.status==="in_progress"?"In Progress":"Active"})]}),e.jsx("div",{className:"text-right",children:e.jsxs("button",{onClick:()=>M(t),className:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors shadow-md hover:shadow-lg flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Track Live"]})})]})},s))}),e.jsx(K,{currentPage:S,totalPages:W(C()),onPageChange:f})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-600",children:"No active collections for today"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Check back later for updates"})]})})]}),y==="week"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800",children:["This Week's Collections - ",l.label]}),e.jsx("p",{className:"text-gray-600",children:"Schedules for the next 7 days"})]}),e.jsx("div",{className:"p-6",children:I().length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:J(I()).map((t,s)=>e.jsx("div",{className:"border border-gray-200 rounded-xl p-6 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.formattedDate}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx(T,{className:"h-4 w-4"}),"Start - ",t.time]}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full mt-2 inline-block ${j(t.status)}`,children:t.status==="in_progress"?"In Progress":t.status==="active"?"Active":t.status==="upcoming"?"Upcoming":t.status.charAt(0).toUpperCase()+t.status.slice(1)})]}),e.jsx("div",{className:"text-right",children:t.status==="active"||t.status==="in_progress"?e.jsxs("button",{onClick:()=>M(t),className:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors shadow-md hover:shadow-lg flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Track Live"]}):e.jsxs("div",{className:"text-gray-500 text-sm",children:[t.timeRemaining.days>0&&`${t.timeRemaining.days}d `,t.timeRemaining.hours,"h ",t.timeRemaining.minutes,"m"]})})]})},s))}),e.jsx(K,{currentPage:S,totalPages:W(I()),onPageChange:f})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(je,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-600",children:"No collections scheduled this week"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Check the month view for upcoming schedules"})]})})]}),y==="month"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800",children:["Monthly Schedule - ",l.label]}),e.jsxs("p",{className:"text-gray-600",children:[N[c]," ",m]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:le,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(q,{className:"h-5 w-5"})}),e.jsx("button",{onClick:ie,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(pe,{className:"h-5 w-5"})})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-4",children:ve.map(t=>e.jsx("div",{className:"text-center text-sm font-semibold text-gray-600 py-2",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:ce()}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:["Collection Schedule for ",N[c]," ",m]}),_().length>0?e.jsx("div",{className:"space-y-4",children:_().map((t,s)=>e.jsx("div",{className:"border border-gray-200 rounded-xl p-6 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.formattedDate}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx(T,{className:"h-4 w-4"}),"Start - ",t.time]}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full mt-2 inline-block ${j(t.status)}`,children:t.status==="in_progress"?"In Progress":t.status==="active"?"Active":t.status==="upcoming"?"Upcoming":t.status.charAt(0).toUpperCase()+t.status.slice(1)})]}),e.jsx("div",{className:"text-right",children:t.status==="active"||t.status==="in_progress"?e.jsxs("button",{onClick:()=>M(t),className:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors shadow-md hover:shadow-lg flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Track Live"]}):e.jsxs("div",{className:"text-gray-500 text-sm",children:[t.timeRemaining.days>0&&`${t.timeRemaining.days}d `,t.timeRemaining.hours,"h ",t.timeRemaining.minutes,"m"]})})]})},s))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(V,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-600",children:["No collections scheduled for ",N[c]," ",m]}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Try navigating to other months"})]})]})]})]}),p&&g&&e.jsx("div",{id:"resident-map-section",className:`${F?"fixed inset-0 z-[9999] bg-white":"mt-12"}`,children:F?e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsx("div",{className:"bg-black px-4 py-3 sm:px-6 sm:py-4 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:U,className:"flex items-center gap-2 text-white hover:bg-white/20 px-3 py-2 rounded-lg transition-colors",children:[e.jsx(q,{className:"h-5 w-5"}),e.jsx("span",{className:"font-semibold",children:"Back"})]}),e.jsxs("div",{className:"flex-1 text-center px-4",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-white truncate",children:l.label}),e.jsxs("p",{className:"text-xs sm:text-sm text-white/90 hidden sm:block",children:[g.formattedDate," at ",g.collection_time]})]}),e.jsx("div",{className:"w-20"})," "]})}),e.jsx("div",{className:"flex-1 relative overflow-hidden",children:e.jsx(X,{mapboxKey:"pk.eyJ1IjoibWFraXNlbnBhaSIsImEiOiJjbTkza3F0NzMwb21tMmxwdzRzYWFncTRoIn0.tRpH1NPUfzt9cvv4IOpxJA",barangayId:l.value,scheduleId:g.id,isFullscreen:!0})})]}):e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Live Collection Map"}),e.jsxs("p",{className:"text-gray-600",children:["Real-time tracking for ",l.label," - ",g.formattedDate]})]}),e.jsx("button",{onClick:U,className:"text-gray-500 hover:text-gray-700 p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(ye,{className:"h-5 w-5"})})]})}),e.jsx("div",{className:"p-6",children:e.jsx(X,{mapboxKey:"pk.eyJ1IjoibWFraXNlbnBhaSIsImEiOiJjbTkza3F0NzMwb21tMmxwdzRzYWFncTRoIn0.tRpH1NPUfzt9cvv4IOpxJA",barangayId:l.value,scheduleId:g.id,isFullscreen:!1})})]})})]})]}),!l&&e.jsxs("div",{className:"max-w-2xl mx-auto text-center py-16",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-100 to-blue-100 rounded-full h-24 w-24 flex items-center justify-center mx-auto mb-6",children:e.jsx(be,{className:"h-12 w-12 text-green-600"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Ready to Track Collections?"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Select your barangay to view ongoing collection schedules"})]})]})]})};export{We as default};
