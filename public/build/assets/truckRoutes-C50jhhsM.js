import{r as s,j as o,Q as M,S as h}from"./app-ChRB4esy.js";import{A as R}from"./AuthenticatedLayout-hD_h1Lr_.js";import z from"./Map-CT4lu4_K.js";import P from"./InsertNewSite-B2sB0006.js";import{F as D}from"./FormModal-Chh6qA5p.js";import{c as L,s as i}from"./SweetAlert-Qokamy9O.js";import"./Dropdown-D-sv90kI.js";import"./app-logo-5yzjSYqx.js";import"./transition-px8oYFIm.js";import"./index-onN-OSVg.js";import"./iconBase-2FgA_EyQ.js";import"./index-DkxHAC3Z.js";import"./index-DK5n2ekv.js";import"./imageHelpers-BzNwYwgf.js";import"./mapbox-gl-CtZq5z7E.js";import"./index-BefslA-j.js";import"./index-BJqDxNyT.js";import"./can-3MqaZyCZ.js";import"./InputError-DdR7E-NE.js";import"./InputLabel-tqOKbM2h.js";import"./PrimaryButton-BT7t0o2m.js";import"./TextInput-5uLmwvjW.js";import"./react-select.esm-Dzky0Hoc.js";import"./index-CnyDuYXe.js";import"./index-DCEew1Wh.js";function de({auth:O,mapboxKey:S}){const[g,b]=s.useState(null),[x,v]=s.useState([]),[y,n]=s.useState(0),[u,l]=s.useState(null),[k,c]=s.useState(!1),[E,a]=s.useState({}),[m,d]=s.useState(!1),[w,j]=s.useState([]),F=e=>{b(e)},T=e=>{setTimeout(()=>{n(t=>t+1),v(t=>[...t,{lng:e.coordinates.lng,lat:e.coordinates.lat,name:e.site_name,barangay:e.barangay,purok:e.purok}])},0)},A=async e=>{var t;if(l(e),a({purok_id:e.purok_id||"",status:e.status||"active"}),(t=e.purok)!=null&&t.baranggay_id)try{const p=await(await fetch(`/barangay/${e.purok.baranggay_id}/puroks`)).json();p.success&&j(p.data.map(f=>({value:f.id,label:f.purok_name})))}catch(r){console.error("Error fetching puroks:",r)}c(!0)},N=async e=>{if(await L("Delete Site",`Are you sure you want to delete "${e.site_name}"? This action cannot be undone.`,"Delete"))try{await h.delete(`/delete/site/${e.id}`,{preserveScroll:!0,onSuccess:()=>{i("success","Site deleted successfully"),n(r=>r+1)},onError:()=>{i("error","Failed to delete site")}})}catch(r){console.error("Delete error:",r),i("error","Failed to delete site")}},_=async e=>{d(!0);try{await h.patch(`/edit/site/${u.id}`,e,{preserveScroll:!0,onSuccess:()=>{i("success","Site updated successfully"),c(!1),l(null),a({}),n(t=>t+1)},onError:t=>{i("error","Failed to update site")},onFinish:()=>{d(!1)}})}catch(t){console.error("Edit submission error:",t),d(!1)}},I=[{name:"purok_id",label:"Purok",type:"select",required:!0,options:w},{name:"status",label:"Status",type:"select",required:!0,options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"pending",label:"Pending"},{value:"maintenance",label:"Maintenance"}]}];return o.jsxs(R,{children:[o.jsx(M,{title:"Truck Routes"}),o.jsxs("div",{className:"h-screen flex flex-col",children:[o.jsxs("div",{className:"flex-1 relative",children:[o.jsx("div",{className:"absolute inset-0",children:o.jsx(z,{mapboxKey:S||"pk.eyJ1IjoibWFraXNlbnBhaSIsImEiOiJjbTkza3F0NzMwb21tMmxwdzRzYWFncTRoIn0.tRpH1NPUfzt9cvv4IOpxJA",onLocationSelect:F,collectionSites:x,refreshTrigger:y,onEditSite:A,onDeleteSite:N})}),o.jsx("div",{className:"absolute top-2 right-2 left-2 sm:left-auto sm:right-4 sm:top-4 w-auto sm:w-80 max-w-full max-h-[calc(100vh-100px)] overflow-y-auto bg-white rounded-lg shadow-lg z-10",children:o.jsx(P,{onSiteAdded:T,selectedLocation:g})})]}),o.jsx(D,{show:k,onClose:()=>{c(!1),l(null),a({})},title:"Edit Site",initialData:u,onSubmit:_,fields:I,submitText:m?"Updating...":"Update Site",processing:m,formData:E,onFormChange:a})]})]})}export{de as default};
