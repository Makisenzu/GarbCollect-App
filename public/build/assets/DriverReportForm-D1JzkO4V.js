import{J as T,r as n,a as g,S as c,j as e}from"./app-Ifd-TfLK.js";const W=({scheduleId:m,token:h})=>{const{props:A}=T(),p=n.useRef(null),[s,u]=n.useState({garbage_id:"",report_pictures:[],kilograms:"",additional_notes:""}),[v,N]=n.useState([]),[w,k]=n.useState(!0),[x,y]=n.useState(!1),[_,C]=n.useState(!1),[l,b]=n.useState([]);n.useEffect(()=>{S(),L()},[m,h]);const S=async()=>{try{(await g.post("/validate-report-token",{schedule_id:m,token:h})).data.valid?C(!0):(alert("Invalid or expired access token. Please complete your route first."),c.visit("/dashboard"))}catch(t){console.error("Token validation error:",t),alert("Error validating access. Please try again."),c.visit("/dashboard")}finally{k(!1)}},L=async()=>{try{const t=await g.get("/garbage-types");N(t.data.data||[])}catch(t){console.error("Error fetching garbage types:",t)}},f=t=>{const{name:r,value:a}=t.target;u(o=>({...o,[r]:a}))},P=t=>{const r=Array.from(t.target.files);if(r.length===0)return;const a=[],o=[];let d=[];for(const i of r){if(!i.type.startsWith("image/")){d.push(`${i.name} is not an image file`);continue}if(i.size>5*1024*1024){d.push(`${i.name} is larger than 5MB`);continue}a.push(i);const j=new FileReader;j.onload=E=>{o.push(E.target.result),o.length===a.length&&b(M=>[...M,...o])},j.readAsDataURL(i)}d.length>0&&alert(d.join(`
`)),a.length>0&&u(i=>({...i,report_pictures:[...i.report_pictures,...a]})),p.current&&(p.current.value="")},R=t=>{u(r=>({...r,report_pictures:r.report_pictures.filter((a,o)=>o!==t)})),b(r=>r.filter((a,o)=>o!==t))},D=async t=>{if(t.preventDefault(),!s.garbage_id||!s.kilograms){alert("Please fill in all required fields");return}if(s.kilograms<0){alert("Weight cannot be negative");return}y(!0);try{const r=new FormData;r.append("schedule_id",m),r.append("garbage_id",s.garbage_id),r.append("kilograms",s.kilograms),r.append("additional_notes",s.additional_notes||""),s.report_pictures.length>0&&s.report_pictures.forEach((o,d)=>{r.append(`report_pictures[${d}]`,o)});const a=await g.post("/submit-report",r,{headers:{"Content-Type":"multipart/form-data"}});a.data.success?(alert("Report submitted successfully!"),await g.post("/invalidate-report-token",{schedule_id:m,token:h}),c.visit("/dashboard")):alert("Failed to submit report: "+(a.data.message||"Unknown error"))}catch(r){console.error("Error submitting report:",r),alert("Error submitting report. Please try again.")}finally{y(!1)}};return w?e.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 font-medium",children:"Validating access..."})]})}):_?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"border-b border-gray-200 px-6 py-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Collection Report"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Submit your collection details"})]}),e.jsxs("form",{onSubmit:D,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:["Garbage Type ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{name:"garbage_id",value:s.garbage_id,onChange:f,required:!0,className:"w-full px-4 py-2.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select Garbage Type"}),v.map(t=>e.jsx("option",{value:t.id,children:t.garbage_type},t.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:["Weight Collected (Kilograms) ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"number",name:"kilograms",value:s.kilograms,onChange:f,min:"0",step:"0.1",required:!0,className:"w-full px-4 py-2.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent",placeholder:"Enter weight in kilograms"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Collection Photos"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors",children:[e.jsx("input",{ref:p,id:"photo-upload",type:"file",accept:"image/*",multiple:!0,onChange:P,className:"hidden"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("div",{children:e.jsxs("label",{htmlFor:"photo-upload",className:"cursor-pointer inline-flex items-center px-4 py-2 bg-gray-900 text-white text-sm font-medium rounded-md hover:bg-gray-800 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Photos"]})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Select multiple images (max 5MB each)"}),l.length>0&&e.jsx("div",{className:"pt-2",children:e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[l.length," photo",l.length!==1?"s":""," selected"]})})]})]}),l.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["Selected Photos (",l.length,")"]}),e.jsx("button",{type:"button",onClick:()=>{u(t=>({...t,report_pictures:[]})),b([])},className:"text-xs font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Remove All"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:l.map((t,r)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t,alt:`Preview ${r+1}`,className:"w-full h-32 object-cover rounded-md border border-gray-200"}),e.jsx("button",{type:"button",onClick:()=>R(r),className:"absolute top-2 right-2 w-7 h-7 flex items-center justify-center bg-white border border-gray-300 text-gray-700 rounded-full hover:bg-gray-100 transition-colors shadow-sm",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("div",{className:"absolute bottom-2 left-2 right-2",children:e.jsxs("div",{className:"bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded text-center",children:["Photo ",r+1]})})]},r))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Additional Notes"}),e.jsx("textarea",{name:"additional_notes",value:s.additional_notes,onChange:f,rows:"4",className:"w-full px-4 py-2.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent resize-none",placeholder:"Any additional information about the collection..."})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>c.visit("/dashboard"),disabled:x,className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-md hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:x,className:"flex-1 px-6 py-3 bg-gray-900 text-white font-medium rounded-md hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Submitting..."]}):"Submit Report"})]})]})]})})}):e.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 flex items-center justify-center rounded-full bg-gray-100",children:e.jsx("svg",{className:"w-8 h-8 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Invalid or expired access token."}),e.jsx("button",{onClick:()=>c.visit("/dashboard"),className:"bg-gray-900 text-white px-6 py-2 rounded-md hover:bg-gray-800 transition-colors font-medium",children:"Return to Dashboard"})]})})};export{W as default};
